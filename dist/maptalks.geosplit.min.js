/*!
 * maptalks.geosplit v0.1.0
 * LICENSE : MIT
 * (c) 2016-2021 maptalks.org
 */
/*!
 * requires maptalks@>=0.31.0 
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var Ft="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n={Point2D:e(function(t){function e(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}e.prototype.clone=function(){return new this.constructor(this.x,this.y)},e.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},e.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},e.prototype.lerp=function(t,e){var n=1-e;return new this.constructor(this.x*n+t.x*e,this.y*n+t.y*e)},e.prototype.distanceFrom=function(t){var e=this.x-t.x,t=this.y-t.y;return Math.sqrt(e*e+t*t)},e.prototype.min=function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))},e.prototype.max=function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))},e.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)},e.prototype.toString=function(){return"point("+this.x+","+this.y+")"},t.exports=e}),Vector2D:e(function(t){function n(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}n.fromPoints=function(t,e){return new n(e.x-t.x,e.y-t.y)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.magnitude=function(){return this.x*this.x+this.y*this.y},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.determinant=function(t){return this.x*t.y-this.y*t.x},n.prototype.unit=function(){return this.divide(this.length())},n.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},n.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},n.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},n.prototype.angleBetween=function(t){var e=this.dot(t)/(this.length()*t.length()),e=Math.max(-1,Math.min(e,1)),e=Math.acos(e);return this.cross(t)<0?-e:e},n.prototype.perp=function(){return new this.constructor(-this.y,this.x)},n.prototype.perpendicular=function(t){return this.subtract(this.project(t))},n.prototype.project=function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)},n.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)},n.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},n.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},n.prototype.toString=function(){return"vector("+this.x+","+this.y+")"},t.exports=n}),Matrix2D:e(function(t){function s(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,enumerable:!0,configurable:!1})}function r(t,e,n,r,i,o){s(this,"a",void 0!==t?t:1),s(this,"b",void 0!==e?e:0),s(this,"c",void 0!==n?n:0),s(this,"d",void 0!==r?r:1),s(this,"e",void 0!==i?i:0),s(this,"f",void 0!==o?o:0)}s(r,"IDENTITY",new r(1,0,0,1,0,0)),s(r.IDENTITY,"isIdentity",function(){return!0}),r.translation=function(t,e){return new r(1,0,0,1,t,e)},r.scaling=function(t){return new r(t,0,0,t,0,0)},r.scalingAt=function(t,e){return new r(t,0,0,t,e.x-e.x*t,e.y-e.y*t)},r.nonUniformScaling=function(t,e){return new r(t,0,0,e,0,0)},r.nonUniformScalingAt=function(t,e,n){return new r(t,0,0,e,n.x-n.x*t,n.y-n.y*e)},r.rotation=function(t){var e=Math.cos(t),t=Math.sin(t);return new r(e,t,-t,e,0,0)},r.rotationAt=function(t,e){var n=Math.cos(t),t=Math.sin(t);return new r(n,t,-t,n,e.x-e.x*n+e.y*t,e.y-e.y*n-e.x*t)},r.rotationFromVector=function(t){var e=t.unit(),t=e.x,e=e.y;return new r(t,e,-e,t,0,0)},r.xFlip=function(){return new r(-1,0,0,1,0,0)},r.yFlip=function(){return new r(1,0,0,-1,0,0)},r.xSkew=function(t){return new r(1,0,Math.tan(t),1,0,0)},r.ySkew=function(t){return new r(1,Math.tan(t),0,1,0,0)},r.prototype.multiply=function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)},r.prototype.inverse=function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0==t)throw"Matrix is not invertible";var e=1/t,n=this.f*this.c-this.e*this.d,t=this.e*this.b-this.f*this.a;return new this.constructor(this.d*e,-this.b*e,-this.c*e,this.a*e,n*e,t*e)},r.prototype.translate=function(t,e){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*e+this.e,this.b*t+this.d*e+this.f)},r.prototype.scale=function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)},r.prototype.scaleAt=function(t,e){var n=e.x-t*e.x,e=e.y-t*e.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*n+this.c*e+this.e,this.b*n+this.d*e+this.f)},r.prototype.scaleNonUniform=function(t,e){return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.e,this.f)},r.prototype.scaleNonUniformAt=function(t,e,n){var r=n.x-t*n.x,n=n.y-e*n.y;return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.a*r+this.c*n+this.e,this.b*r+this.d*n+this.f)},r.prototype.rotate=function(t){var e=Math.cos(t),t=Math.sin(t);return new this.constructor(this.a*e+this.c*t,this.b*e+this.d*t,this.a*-t+this.c*e,this.b*-t+this.d*e,this.e,this.f)},r.prototype.rotateAt=function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x,o=e.y,s=this.a*n+this.c*r,t=this.b*n+this.d*r,e=this.c*n-this.a*r,r=this.d*n-this.b*r;return new this.constructor(s,t,e,r,(this.a-s)*i+(this.c-e)*o+this.e,(this.b-t)*i+(this.d-r)*o+this.f)},r.prototype.rotateFromVector=function(t){var e=t.unit(),t=e.x,e=e.y;return new this.constructor(this.a*t+this.c*e,this.b*t+this.d*e,this.a*-e+this.c*t,this.b*-e+this.d*t,this.e,this.f)},r.prototype.flipX=function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)},r.prototype.flipY=function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)},r.prototype.skewX=function(t){t=Math.tan(t);return new this.constructor(this.a,this.b,this.c+this.a*t,this.d+this.b*t,this.e,this.f)},r.prototype.skewY=function(t){t=Math.tan(t);return new this.constructor(this.a+this.c*t,this.b+this.d*t,this.c,this.d,this.e,this.f)},r.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},r.prototype.isInvertible=function(){return this.a*this.d-this.b*this.c!=0},r.prototype.getScale=function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}},r.prototype.getDecomposition=function(){var t=.5*(this.a+this.d),e=.5*(this.a-this.d),n=.5*(this.b+this.c),r=.5*(this.b-this.c),i=Math.sqrt(t*t+r*r),o=Math.sqrt(e*e+n*n),s=i+o,o=i-o,e=Math.atan2(n,e),r=Math.atan2(r,t),t=.5*(r-e),e=.5*(r+e);return{translation:new this.constructor(1,0,0,1,this.e,this.f),rotation:this.constructor.IDENTITY.rotate(e),scale:new this.constructor(s,0,0,o,0,0),rotation0:this.constructor.IDENTITY.rotate(t)}},r.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},r.prototype.precisionEquals=function(t,e){return Math.abs(this.a-t.a)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.c-t.c)<e&&Math.abs(this.d-t.d)<e&&Math.abs(this.e-t.e)<e&&Math.abs(this.f-t.f)<e},r.prototype.toString=function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"},t.exports=r})},r=e(function(t){function f(){this.init(arguments)}f.TOLERANCE=1e-6,f.ACCURACY=15,f.interpolate=function(t,e,n,r,i){if(t.constructor!==Array||e.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(r)||isNaN(i))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var o=0,s=0,a=new Array(n),u=new Array(n),c=0,h=Math.abs(i-t[r]),l=0;l<n;l++){var y=Math.abs(i-t[r+l]);y<h&&(c=l,h=y),a[l]=u[l]=e[r+l]}o=e[r+c],c--;for(var p=1;p<n;p++){for(l=0;l<n-p;l++){var f=t[r+l]-i,d=t[r+l+p]-i,x=a[l+1]-u[l],g=f-d;if(0==g)throw new Error("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");u[l]=d*(g=x/g),a[l]=f*g}o+=s=2*(c+1)<n-p?a[c+1]:u[c--]}return{y:o,dy:s}},f.prototype.init=function(t){this.coefs=new Array;for(var e=t.length-1;0<=e;e--)this.coefs.push(t[e]);this._variable="t",this._s=0},f.prototype.eval=function(t){if(isNaN(t))throw new Error("Polynomial.eval: parameter must be a number");for(var e=0,n=this.coefs.length-1;0<=n;n--)e=e*t+this.coefs[n];return e},f.prototype.add=function(t){for(var e=new f,n=this.getDegree(),r=t.getDegree(),i=Math.max(n,r),o=0;o<=i;o++){var s=o<=n?this.coefs[o]:0,a=o<=r?t.coefs[o]:0;e.coefs[o]=s+a}return e},f.prototype.multiply=function(t){for(var e=new f,n=0;n<=this.getDegree()+t.getDegree();n++)e.coefs.push(0);for(n=0;n<=this.getDegree();n++)for(var r=0;r<=t.getDegree();r++)e.coefs[n+r]+=this.coefs[n]*t.coefs[r];return e},f.prototype.divide_scalar=function(t){for(var e=0;e<this.coefs.length;e++)this.coefs[e]/=t},f.prototype.simplify=function(t){void 0===t&&(t=1e-12);for(var e=this.getDegree();0<=e&&Math.abs(this.coefs[e])<=t;e--)this.coefs.pop()},f.prototype.bisection=function(t,e){var n=this.eval(t),r=this.eval(e);if(Math.abs(n)<=f.TOLERANCE)u=t;else if(Math.abs(r)<=f.TOLERANCE)u=e;else if(n*r<=0)for(var i=Math.log(e-t),o=Math.LN10*f.ACCURACY,s=Math.ceil((i+o)/Math.LN2),a=0;a<s;a++){var u,c=this.eval(u=.5*(t+e));if(Math.abs(c)<=f.TOLERANCE)break;c*n<0?(e=u,r=c):(t=u,n=c)}return u},f.prototype.toString=function(){for(var t=new Array,e=new Array,n=this.coefs.length-1;0<=n;n--){var r,i=Math.round(1e3*this.coefs[n])/1e3;0!=i&&(r=i<0?" - ":" + ",i=Math.abs(i),0<n&&(1==i?i=this._variable:i+=this._variable),1<n&&(i+="^"+n),e.push(r),t.push(i))}e[0]=" + "==e[0]?"":"-";for(var o="",n=0;n<t.length;n++)o+=e[n]+t[n];return o},f.prototype.trapezoid=function(t,e,n){if(isNaN(t)||isNaN(e)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var r=e-t;if(1==n){var i=this.eval(t),e=this.eval(e);this._s=.5*r*(i+e)}else{for(var o=1<<n-2,s=r/o,a=t+.5*s,u=0,c=0;c<o;c++)u+=this.eval(a),a+=s;this._s=.5*(this._s+r*u/o)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s},f.prototype.simpson=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.simpson: parameters must be numbers");for(var n=e-t,r=.5*n*(this.eval(t)+this.eval(e)),i=r,o=4*r/3,s=o,a=r,u=1,c=2;c<=20;c++){for(var h=n/u,l=t+.5*h,y=0,p=1;p<=u;p++)y+=this.eval(l),l+=h;if(o=(4*(r=i=.5*(i+n*y/u))-a)/3,Math.abs(o-s)<1e-7*Math.abs(s))break;s=o,a=r,u<<=1}return o},f.prototype.romberg=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.romberg: parameters must be numbers");for(var n=new Array(21),r=new Array(21),i={y:0,dy:0},o=r[0]=1;o<=20&&(n[o-1]=this.trapezoid(t,e,o),!(3<=o&&(i=f.interpolate(r,n,3,o-3,0),Math.abs(i.dy)<=1e-6*i.y)));o++)n[o]=n[o-1],r[o]=.25*r[o-1];return i.y},f.prototype.getDegree=function(){return this.coefs.length-1},f.prototype.getDerivative=function(){for(var t=new f,e=1;e<this.coefs.length;e++)t.coefs.push(e*this.coefs[e]);return t},f.prototype.getRoots=function(){var t;switch(this.simplify(),this.getDegree()){case 0:t=[];break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots();break;default:t=[]}return t},f.prototype.getRootsInInterval=function(t,e){var n,r=new Array;if(1==this.getDegree())null!=(n=this.bisection(t,e))&&r.push(n);else{var o=this.getDerivative().getRootsInInterval(t,e);if(0<o.length){for(null!=(n=this.bisection(t,o[0]))&&r.push(n),i=0;i<=o.length-2;i++)null!=(n=this.bisection(o[i],o[i+1]))&&r.push(n);null!=(n=this.bisection(o[o.length-1],e))&&r.push(n)}else null!=(n=this.bisection(t,e))&&r.push(n)}return r},f.prototype.getLinearRoot=function(){var t=[],e=this.coefs[1];return 0!=e&&t.push(-this.coefs[0]/e),t},f.prototype.getQuadraticRoots=function(){var t,e,n,r=[];return 2==this.getDegree()&&(n=this.coefs[2],0<(e=(t=this.coefs[1]/n)*t-4*(this.coefs[0]/n))?(n=Math.sqrt(e),r.push(.5*(-t+n)),r.push(.5*(-t-n))):0==e&&r.push(.5*-t)),r},f.prototype.getCubicRoots=function(){var t,e,n,r,i,o,s,a,u=[];return 3==this.getDegree()&&(i=this.coefs[3],t=(e=this.coefs[2]/i)/3,o=(n=(2*e*e*e-9*(o=this.coefs[1]/i)*e+27*(this.coefs[0]/i))/27)*n/4+(i=(3*o-e*e)/3)*i*i/27,e=n/2,n=this.zeroErrorEstimate(),0<(o=Math.abs(o)<=n?0:o)?(s=0<=(a=-e+(r=Math.sqrt(o)))?Math.pow(a,1/3):-Math.pow(-a,1/3),0<=(a=-e-r)?s+=Math.pow(a,1/3):s-=Math.pow(-a,1/3),u.push(s-t)):o<0?(r=Math.sqrt(-i/3),s=Math.atan2(Math.sqrt(-o),-e)/3,i=Math.cos(s),o=Math.sin(s),s=Math.sqrt(3),u.push(2*r*i-t),u.push(-r*(i+s*o)-t),u.push(-r*(i-s*o)-t)):(a=0<=e?-Math.pow(e,1/3):Math.pow(-e,1/3),u.push(2*a-t),u.push(-a-t))),u};function _(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN}f.prototype.getQuarticRoots=function(){var t=[],e=this.getDegree();if(4==e){var n=new f;n.coefs=this.coefs.slice(),n.divide_scalar(n.coefs[e]);Math.abs(n.coefs[0])<10*1e-15*Math.abs(n.coefs[3])&&(n.coefs[0]=0);var r=n.getDerivative(),i=r.getRoots().sort(function(t,e){return t-e}),o=[],s=i.length-1,a=this.bounds();maxabsX=Math.max(Math.abs(a.minX),Math.abs(a.maxX));for(var u=this.zeroErrorEstimate(maxabsX),c=0;c<=s;c++)o.push(n.eval(i[c]));for(c=0;c<=s;c++)Math.abs(o[c])<u&&(o[c]=0);c=0;var e=Math.max(.1*(a.maxX-a.minX)/e,1e-15),h=[],l=[];if(-1<s){for(0!=o[0]?_(o[0])!=_(n.eval(i[0]-e)-o[0])&&(h.push(i[0]-e),l.push([a.minX,i[0]])):(t.push(i[0],i[0]),c++);c<s;c++)0==o[c+1]?(t.push(i[c+1],i[c+1]),c++):_(o[c])!=_(o[c+1])&&(h.push((i[c]+i[c+1])/2),l.push([i[c],i[c+1]]));0!=o[s]&&_(o[s])!=_(n.eval(i[s]+e)-o[s])&&(h.push(i[s]+e),l.push([i[s],a.maxX]))}var y=function(t){return n.eval(t)},p=function(t){return r.eval(t)};if(0<h.length)for(c=0;c<h.length;c++)h[c]=f.newton_secant_bisection(h[c],y,p,32,l[c][0],l[c][1]);t=t.concat(h)}return t},f.prototype.zeroErrorEstimate=function(r){var t=this;if(void 0===r&&(e=t.bounds(),r=Math.max(Math.abs(e.minX),Math.abs(e.maxX))),r<.001)return 2*Math.abs(t.eval(1e-15));var e=t.coefs.length-1,i=t.coefs[e];return 10*1e-15*t.coefs.reduce(function(t,e,n){n=e/i*Math.pow(r,n);return t<n?n:t},0)},f.prototype.bounds_UpperReal_Fujiwara=function(){function t(t,e,n){return o(n)&&(t.max<e?(t.nearmax=t.max,t.max=e):t.nearmax<e&&(t.nearmax=e)),t}var e=this.coefs,n=e.length-1,r=e[n],i=(e=1!=r?this.coefs.map(function(t){return t/r}):e).map(function(t,e){return e<n?Math.pow(Math.abs(0==e?t/2:t),1/(n-e)):t}),o=function(t){return t<n&&e[t]<0},s=i.reduce(t,{max:0,nearmax:0});return o=function(t){return t<n&&(n%2==t%2?e[t]<0:0<e[t])},{negX:-2*i.reduce(t,{max:0,nearmax:0}).max,posX:2*s.max}},f.prototype.bounds_LowerReal_Fujiwara=function(){var t=new f;t.coefs=this.coefs.slice().reverse();t=t.bounds_UpperReal_Fujiwara();return t.negX=1/t.negX,t.posX=1/t.posX,t},f.prototype.bounds=function(){var t=this.bounds_UpperReal_Fujiwara(),e={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX||(0===t.negX?e.minX=this.bounds_LowerReal_Fujiwara().posX:0===t.posX&&(e.maxX=this.bounds_LowerReal_Fujiwara().negX),e.minX>e.maxX&&(e.minX=e.maxX=0)),e},f.newton_secant_bisection=function(t,e,n,r,i,o){var s,a,u=0,c=0,h=t,l=Math.pow(10,-14),p="number"==typeof i&&"number"==typeof o;if(p){if(o<i)throw new Error("newton root finding: min must be greater than max");if(s=e(i),a=e(o),_(s)==_(a))throw new Error("newton root finding: y values of bounds must be of opposite sign")}for(var f=function(){return Math.abs(v)<=l*Math.abs(h)||c==h-v-h},d=0;d<r;d++){if(0==(g=n(h))){if(0==u)throw new Error("newton root finding: df(x) is zero");g=u}if(u=g,y=e(h),v=y/g,m=h-v,f())break;if(p){if(_(y)==_(a))o=h,a=y;else{if(_(y)!=_(s)){h=m;break}i=h,s=y}if(m<i||o<m){if(_(s)==_(a))break;var x=a-s,g=o-i,v=0==x?h-(i+.5*g):50<Math.abs(x/Math.min(s,a))?h-(i+g*(.5+(Math.abs(s)<Math.abs(a)?-.25:.25))):h-(i-s/x*g),m=h-v;if(f())break}}c=h-m,h=m}return h},t.exports=f}),o=e(function(t){var e=r;function n(){this.init(arguments)}n.VERSION=1,((n.prototype=new e).constructor=n).superclass=e.prototype,n.prototype.eval=function(t){t=n.superclass.eval.call(this,t);if((t=Math.abs(t)<1e-7?0:t)<0)throw new Error("SqrtPolynomial.eval: cannot take square root of negative number");return Math.sqrt(t)},n.prototype.toString=function(){return"sqrt("+n.superclass.toString.call(this)+")"},t.exports=n}),s={Polynomial:r,SqrtPolynomial:o},a=e(function(t){var R=n.Point2D,q=n.Vector2D,W=s.Polynomial;function o(t){var e=t.slice();return e.push(t[0]),e}function U(t){this.init(t)}U.prototype.init=function(t){this.status=t,this.points=new Array},U.prototype.appendPoint=function(t){this.points.push(t)},U.prototype.appendPoints=function(t){this.points=this.points.concat(t)},U.intersect=function(t,e){var n;if(null!=t&&null!=e)if("Path"==t.name)n=U.intersectPathShape(t,e);else if("Path"==e.name)n=U.intersectPathShape(e,t);else{var r,t=t.name<e.name?(r="intersect"+t.name+e.name,t.args.concat(e.args)):(r="intersect"+e.name+t.name,e.args.concat(t.args));if(!(r in U))throw new Error("Intersection not available: "+r);n=U[r].apply(null,t)}else n=new U("No Intersection");return n},U.intersectPathShape=function(t,e){for(var n=new U("No Intersection"),r=t.args.length,i=0;i<r;i++){var o=t.args[i],o=U.intersect(o,e);n.appendPoints(o.points)}return 0<n.points.length&&(n.status="Intersection"),n},U.intersectBezier2Bezier2=function(t,e,n,r,i,o){var s,a,u,c,h=new U("No Intersection");p=e.multiply(-2),s=t.add(p.add(n)),p=t.multiply(-2),n=e.multiply(2),a=p.add(n),u=new R(t.x,t.y),p=i.multiply(-2),c=r.add(p.add(o)),p=r.multiply(-2),n=i.multiply(2);for(var l=p.add(n),y=new R(r.x,r.y),p=s.x*a.y-a.x*s.y,n=c.x*a.y-a.x*c.y,e=l.x*a.y-a.x*l.y,t=a.x*(u.y-y.y)+a.y*(-u.x+y.x),o=c.x*s.y-s.x*c.y,i=l.x*s.y-s.x*l.y,r=s.x*(u.y-y.y)+s.y*(-u.x+y.x),f=new W(-o*o,-2*o*i,p*n-i*i-2*o*r,p*e-2*i*r,p*t-r*r).getRoots(),d=0;d<f.length;d++){var x=f[d];if(0<=x&&x<=1){var g=new W(s.x,a.x,u.x-y.x-x*l.x-x*x*c.x);g.simplify();var v=g.getRoots(),g=new W(s.y,a.y,u.y-y.y-x*l.y-x*x*c.y);g.simplify();var m=g.getRoots();if(0<v.length&&0<m.length)t:for(var _=0;_<v.length;_++){var b=v[_];if(0<=b&&b<=1)for(var w=0;w<m.length;w++)if(Math.abs(b-m[w])<1e-4){h.points.push(c.multiply(x*x).add(l.multiply(x).add(y)));break t}}}}return 0<h.points.length&&(h.status="Intersection"),h},U.intersectBezier2Bezier3=function(t,e,n,r,i,o,s){var a,u,c,h,l=new U("No Intersection"),y=e.multiply(-2),p=t.add(y.add(n));y=t.multiply(-2),f=e.multiply(2),a=y.add(f),u=new R(t.x,t.y),y=r.multiply(-1),f=i.multiply(3),d=o.multiply(-3),b=y.add(f.add(d.add(s))),c=new q(b.x,b.y),y=r.multiply(3),f=i.multiply(-6),d=o.multiply(3),b=y.add(f.add(d)),h=new q(b.x,b.y),y=r.multiply(-3);for(var f=i.multiply(3),d=y.add(f),x=new q(d.x,d.y),g=new q(r.x,r.y),v=u.x*u.x,m=u.y*u.y,_=a.x*a.x,n=a.y*a.y,e=p.x*p.x,t=p.y*p.y,s=g.x*g.x,o=g.y*g.y,b=x.x*x.x,i=x.y*x.y,y=h.x*h.x,f=h.y*h.y,d=c.x*c.x,r=c.y*c.y,w=new W(-2*p.x*p.y*c.x*c.y+e*r+t*d,-2*p.x*p.y*h.x*c.y-2*p.x*p.y*h.y*c.x+2*t*h.x*c.x+2*e*h.y*c.y,-2*p.x*x.x*p.y*c.y-2*p.x*p.y*x.y*c.x-2*p.x*p.y*h.x*h.y+2*x.x*t*c.x+t*y+e*(2*x.y*c.y+f),2*u.x*p.x*p.y*c.y+2*u.y*p.x*p.y*c.x+a.x*a.y*p.x*c.y+a.x*a.y*p.y*c.x-2*g.x*p.x*p.y*c.y-2*p.x*g.y*p.y*c.x-2*p.x*x.x*p.y*h.y-2*p.x*p.y*x.y*h.x-2*u.x*t*c.x-2*u.y*e*c.y+2*g.x*t*c.x+2*x.x*t*h.x-n*p.x*c.x-_*p.y*c.y+e*(2*g.y*c.y+2*x.y*h.y),2*u.x*p.x*p.y*h.y+2*u.y*p.x*p.y*h.x+a.x*a.y*p.x*h.y+a.x*a.y*p.y*h.x-2*g.x*p.x*p.y*h.y-2*p.x*g.y*p.y*h.x-2*p.x*x.x*p.y*x.y-2*u.x*t*h.x-2*u.y*e*h.y+2*g.x*t*h.x-n*p.x*h.x-_*p.y*h.y+b*t+e*(2*g.y*h.y+i),2*u.x*p.x*p.y*x.y+2*u.y*p.x*x.x*p.y+a.x*a.y*p.x*x.y+a.x*a.y*x.x*p.y-2*g.x*p.x*p.y*x.y-2*p.x*g.y*x.x*p.y-2*u.x*x.x*t-2*u.y*e*x.y+2*g.x*x.x*t-n*p.x*x.x-_*p.y*x.y+2*e*g.y*x.y,-2*u.x*u.y*p.x*p.y-u.x*a.x*a.y*p.y-u.y*a.x*a.y*p.x+2*u.x*p.x*g.y*p.y+2*u.y*g.x*p.x*p.y+a.x*g.x*a.y*p.y+a.x*a.y*p.x*g.y-2*g.x*p.x*g.y*p.y-2*u.x*g.x*t+u.x*n*p.x+u.y*_*p.y-2*u.y*e*g.y-g.x*n*p.x-_*g.y*p.y+v*t+m*e+s*t+e*o).getRootsInInterval(0,1),P=0;P<w.length;P++){var M=w[P],I=new W(p.x,a.x,u.x-g.x-M*x.x-M*M*h.x-M*M*M*c.x).getRoots(),L=new W(p.y,a.y,u.y-g.y-M*x.y-M*M*h.y-M*M*M*c.y).getRoots();if(0<I.length&&0<L.length)t:for(var S=0;S<I.length;S++){var j=I[S];if(0<=j&&j<=1)for(var E=0;E<L.length;E++)if(Math.abs(j-L[E])<1e-4){l.points.push(c.multiply(M*M*M).add(h.multiply(M*M).add(x.multiply(M).add(g))));break t}}}return 0<l.points.length&&(l.status="Intersection"),l},U.intersectBezier2Circle=function(t,e,n,r,i){return U.intersectBezier2Ellipse(t,e,n,r,i,i)},U.intersectBezier2Ellipse=function(t,e,n,r,i,o){var s=new U("No Intersection"),a=e.multiply(-2),u=t.add(a.add(n));a=t.multiply(-2);for(var e=e.multiply(2),c=a.add(e),h=new R(t.x,t.y),i=i*i,o=o*o,l=new W(o*u.x*u.x+i*u.y*u.y,2*(o*u.x*c.x+i*u.y*c.y),o*(2*u.x*h.x+c.x*c.x)+i*(2*u.y*h.y+c.y*c.y)-2*(o*r.x*u.x+i*r.y*u.y),2*(o*c.x*(h.x-r.x)+i*c.y*(h.y-r.y)),o*(h.x*h.x+r.x*r.x)+i*(h.y*h.y+r.y*r.y)-2*(o*r.x*h.x+i*r.y*h.y)-i*o).getRoots(),y=0;y<l.length;y++){var p=l[y];0<=p&&p<=1&&s.points.push(u.multiply(p*p).add(c.multiply(p).add(h)))}return 0<s.points.length&&(s.status="Intersection"),s},U.intersectBezier2Line=function(t,e,n,r,i){var o,s,a,u=r.min(i),c=r.max(i),h=new U("No Intersection"),l=e.multiply(-2),y=t.add(l.add(n));l=t.multiply(-2),a=e.multiply(2),o=l.add(a),s=new R(t.x,t.y),l=new q(r.y-i.y,i.x-r.x),a=r.x*i.y-i.x*r.y,roots=new W(l.dot(y),l.dot(o),l.dot(s)+a).getRoots();for(var p=0;p<roots.length;p++){var f,d,x=roots[p];0<=x&&x<=1&&(f=t.lerp(e,x),d=e.lerp(n,x),x=f.lerp(d,x),r.x==i.x?u.y<=x.y&&x.y<=c.y&&(h.status="Intersection",h.appendPoint(x)):r.y==i.y?u.x<=x.x&&x.x<=c.x&&(h.status="Intersection",h.appendPoint(x)):u.x<=x.x&&x.x<=c.x&&u.y<=x.y&&x.y<=c.y&&(h.status="Intersection",h.appendPoint(x)))}return h},U.intersectBezier2Polygon=function(t,e,n,r){return U.intersectBezier2Polyline(t,e,n,o(r))},U.intersectBezier2Polyline=function(t,e,n,r){for(var i=new U("No Intersection"),o=r.length,s=0;s<o-1;s++){var a=r[s],u=r[s+1],u=U.intersectBezier2Line(t,e,n,a,u);i.appendPoints(u.points)}return 0<i.points.length&&(i.status="Intersection"),i},U.intersectBezier2Rectangle=function(t,e,n,r,i){var o=r.min(i),s=r.max(i),a=new R(s.x,o.y),r=new R(o.x,s.y),i=U.intersectBezier2Line(t,e,n,o,a),a=U.intersectBezier2Line(t,e,n,a,s),s=U.intersectBezier2Line(t,e,n,s,r),r=U.intersectBezier2Line(t,e,n,r,o),o=new U("No Intersection");return o.appendPoints(i.points),o.appendPoints(a.points),o.appendPoints(s.points),o.appendPoints(r.points),0<o.points.length&&(o.status="Intersection"),o},U.intersectBezier3Bezier3=function(t,e,n,r,i,o,s,a){var u,c,h,l,y,p,f=new U("No Intersection");v=t.multiply(-1),m=e.multiply(3),d=n.multiply(-3),M=v.add(m.add(d.add(r))),u=new q(M.x,M.y),v=t.multiply(3),m=e.multiply(-6),d=n.multiply(3),M=v.add(m.add(d)),c=new q(M.x,M.y),v=t.multiply(-3),m=e.multiply(3),d=v.add(m),h=new q(d.x,d.y),l=new q(t.x,t.y),v=i.multiply(-1),m=o.multiply(3),d=s.multiply(-3),M=v.add(m.add(d.add(a))),y=new q(M.x,M.y),v=i.multiply(3),m=o.multiply(-6),d=s.multiply(3),M=v.add(m.add(d)),p=new q(M.x,M.y),v=i.multiply(-3),m=o.multiply(3);var d=v.add(m),x=new q(d.x,d.y),g=new q(i.x,i.y),v=u.x*c.y-c.x*u.y,m=u.x*h.y-h.x*u.y,_=u.x*l.y-l.x*u.y+g.x*u.y-u.x*g.y,b=x.x*u.y-u.x*x.y,w=p.x*u.y-u.x*p.y,P=y.x*u.y-u.x*y.y,M=u.x*h.y-h.x*u.y,I=u.x*l.y+c.x*h.y-h.x*c.y-l.x*u.y+g.x*u.y-u.x*g.y,L=x.x*u.y-u.x*x.y,S=p.x*u.y-u.x*p.y,j=y.x*u.y-u.x*y.y,E=c.x*l.y-l.x*c.y+g.x*c.y-c.x*g.y,R=x.x*c.y-c.x*x.y,T=p.x*c.y-c.x*p.y,C=y.x*c.y-c.x*y.y,N=u.x*l.y-l.x*u.y+g.x*u.y-u.x*g.y,z=x.x*u.y-u.x*x.y,O=p.x*u.y-u.x*p.y,r=y.x*u.y-u.x*y.y,n=c.x*l.y-l.x*c.y+g.x*c.y-c.x*g.y,e=x.x*c.y-c.x*x.y,t=p.x*c.y-c.x*p.y,a=y.x*c.y-c.x*y.y,s=h.x*l.y-l.x*h.y+g.x*h.y-h.x*g.y,o=x.x*h.y-h.x*x.y,d=p.x*h.y-h.x*p.y,i=y.x*h.y-h.x*y.y,s=new W(-P*j*r,-P*j*O-P*S*r-w*j*r,-P*j*z-P*S*O-w*j*O-P*L*r-w*S*r-b*j*r,-P*j*N-P*S*z-w*j*z-P*L*O-w*S*O-b*j*O-P*I*r-w*L*r-b*S*r-_*j*r+m*C*r+P*M*a-v*C*a+v*j*i,-P*S*N-w*j*N-P*L*z-w*S*z-b*j*z-P*I*O-w*L*O-b*S*O-_*j*O+m*C*O-w*I*r-b*L*r-_*S*r+m*T*r+P*M*t-v*C*t+w*M*a-v*T*a+v*j*d+v*S*i,-P*L*N-w*S*N-b*j*N-P*I*z-w*L*z-b*S*z-_*j*z+m*C*z-w*I*O-b*L*O-_*S*O+m*T*O-b*I*r-_*L*r+m*R*r+P*M*e-v*C*e+w*M*t-v*T*t+b*M*a-v*R*a+v*j*o+v*S*d+v*L*i,-P*I*N-w*L*N-b*S*N-_*j*N+m*C*N-w*I*z-b*L*z-_*S*z+m*T*z-b*I*O-_*L*O+m*R*O-_*I*r+m*E*r+P*M*n-v*C*n+w*M*e-v*T*e+b*M*t-v*R*t+_*M*a-v*E*a+v*j*s+v*S*o+v*L*d-m*M*i+v*I*i,-w*I*N-b*L*N-_*S*N+m*T*N-b*I*z-_*L*z+m*R*z-_*I*O+m*E*O+w*M*n-v*T*n+b*M*e-v*R*e+_*M*t-v*E*t+v*S*s+v*L*o-m*M*d+v*I*d,-b*I*N-_*L*N+m*R*N-_*I*z+m*E*z+b*M*n-v*R*n+_*M*e-v*E*e+v*L*s-m*M*o+v*I*o,-_*I*N+m*E*N+_*M*n-v*E*n-m*M*s+v*I*s);s.simplify();for(var k=s.getRootsInInterval(0,1),A=0;A<k.length;A++){var B=k[A],F=new W(u.x,c.x,h.x,l.x-g.x-B*x.x-B*B*p.x-B*B*B*y.x);F.simplify(),xRoots=F.getRoots();F=new W(u.y,c.y,h.y,l.y-g.y-B*x.y-B*B*p.y-B*B*B*y.y);if(F.simplify(),yRoots=F.getRoots(),0<xRoots.length&&0<yRoots.length)t:for(var D=0;D<xRoots.length;D++){var X=xRoots[D];if(0<=X&&X<=1)for(var G=0;G<yRoots.length;G++)if(Math.abs(X-yRoots[G])<1e-4){f.points.push(y.multiply(B*B*B).add(p.multiply(B*B).add(x.multiply(B).add(g))));break t}}}return 0<f.points.length&&(f.status="Intersection"),f},U.intersectBezier3Circle=function(t,e,n,r,i,o){return U.intersectBezier3Ellipse(t,e,n,r,i,o,o)},U.intersectBezier3Ellipse=function(t,e,n,r,i,o,s){var a,u=new U("No Intersection"),c=t.multiply(-1),h=e.multiply(3),l=n.multiply(-3),r=c.add(h.add(l.add(r))),y=new q(r.x,r.y);c=t.multiply(3),h=e.multiply(-6),l=n.multiply(3),r=c.add(h.add(l)),a=new q(r.x,r.y),c=t.multiply(-3),h=e.multiply(3),l=c.add(h);for(var p=new q(l.x,l.y),f=new q(t.x,t.y),o=o*o,s=s*s,d=new W(y.x*y.x*s+y.y*y.y*o,2*(y.x*a.x*s+y.y*a.y*o),2*(y.x*p.x*s+y.y*p.y*o)+a.x*a.x*s+a.y*a.y*o,2*y.x*s*(f.x-i.x)+2*y.y*o*(f.y-i.y)+2*(a.x*p.x*s+a.y*p.y*o),2*a.x*s*(f.x-i.x)+2*a.y*o*(f.y-i.y)+p.x*p.x*s+p.y*p.y*o,2*p.x*s*(f.x-i.x)+2*p.y*o*(f.y-i.y),f.x*f.x*s-2*f.y*i.y*o-2*f.x*i.x*s+f.y*f.y*o+i.x*i.x*s+i.y*i.y*o-o*s).getRootsInInterval(0,1),x=0;x<d.length;x++){var g=d[x];u.points.push(y.multiply(g*g*g).add(a.multiply(g*g).add(p.multiply(g).add(f))))}return 0<u.points.length&&(u.status="Intersection"),u},U.intersectBezier3Line=function(t,e,n,r,i,o){var s,a=i.min(o),u=i.max(o),c=new U("No Intersection"),h=t.multiply(-1),l=e.multiply(3),y=n.multiply(-3),p=h.add(l.add(y.add(r))),f=new q(p.x,p.y);h=t.multiply(3),l=e.multiply(-6),y=n.multiply(3),p=h.add(l.add(y)),s=new q(p.x,p.y),h=t.multiply(-3),l=e.multiply(3),y=h.add(l),p=new q(y.x,y.y),h=new q(t.x,t.y),l=new q(i.y-o.y,o.x-i.x),y=i.x*o.y-o.x*i.y,roots=new W(l.dot(f),l.dot(s),l.dot(p),l.dot(h)+y).getRoots();for(var d=0;d<roots.length;d++){var x,g,v,m=roots[d];0<=m&&m<=1&&(g=t.lerp(e,m),x=e.lerp(n,m),v=n.lerp(r,m),g=g.lerp(x,m),v=x.lerp(v,m),m=g.lerp(v,m),i.x==o.x?a.y<=m.y&&m.y<=u.y&&(c.status="Intersection",c.appendPoint(m)):i.y==o.y?a.x<=m.x&&m.x<=u.x&&(c.status="Intersection",c.appendPoint(m)):a.x<=m.x&&m.x<=u.x&&a.y<=m.y&&m.y<=u.y&&(c.status="Intersection",c.appendPoint(m)))}return c},U.intersectBezier3Polygon=function(t,e,n,r,i){return this.intersectBezier3Polyline(t,e,n,r,o(i))},U.intersectBezier3Polyline=function(t,e,n,r,i){for(var o=new U("No Intersection"),s=i.length,a=0;a<s-1;a++){var u=i[a],c=i[a+1],c=U.intersectBezier3Line(t,e,n,r,u,c);o.appendPoints(c.points)}return 0<o.points.length&&(o.status="Intersection"),o},U.intersectBezier3Rectangle=function(t,e,n,r,i,o){var s=i.min(o),a=i.max(o),u=new R(a.x,s.y),i=new R(s.x,a.y),o=U.intersectBezier3Line(t,e,n,r,s,u),u=U.intersectBezier3Line(t,e,n,r,u,a),a=U.intersectBezier3Line(t,e,n,r,a,i),i=U.intersectBezier3Line(t,e,n,r,i,s),s=new U("No Intersection");return s.appendPoints(o.points),s.appendPoints(u.points),s.appendPoints(a.points),s.appendPoints(i.points),0<s.points.length&&(s.status="Intersection"),s},U.intersectCircleCircle=function(t,e,n,r){var i,o=e+r,s=Math.abs(e-r),a=t.distanceFrom(n);return o<a?i=new U("Outside"):a<s?i=new U("Inside"):(i=new U("Intersection"),r=(e*e-r*r+a*a)/(2*a),e=Math.sqrt(e*e-r*r),r=t.lerp(n,r/a),i.points.push(new R(r.x-(a=e/a)*(n.y-t.y),r.y+a*(n.x-t.x))),i.points.push(new R(r.x+a*(n.y-t.y),r.y-a*(n.x-t.x)))),i},U.intersectCircleEllipse=function(t,e,n,r,i){return U.intersectEllipseEllipse(t,e,e,n,r,i)},U.intersectCircleLine=function(t,e,n,r){var i,o=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),s=2*((r.x-n.x)*(n.x-t.x)+(r.y-n.y)*(n.y-t.y)),t=s*s-4*o*(t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-e*e);return t<0?i=new U("Outside"):0==t?i=new U("Tangent"):(t=(-s-(e=Math.sqrt(t)))/(2*o),((o=(-s+e)/(2*o))<0||1<o)&&(t<0||1<t)?i=new U(o<0&&t<0||1<o&&1<t?"Outside":"Inside"):(i=new U("Intersection"),0<=o&&o<=1&&i.points.push(n.lerp(r,o)),0<=t&&t<=1&&i.points.push(n.lerp(r,t)))),i},U.intersectCirclePolygon=function(t,e,n){return this.intersectCirclePolyline(t,e,o(n))},U.intersectCirclePolyline=function(t,e,n){for(var r=new U("No Intersection"),i=n.length,o=0;o<i-1;o++){var s=n[o],a=n[o+1],u=U.intersectCircleLine(t,e,s,a);r.appendPoints(u.points)}return 0<r.points.length?r.status="Intersection":r.status=u.status,r},U.intersectCircleRectangle=function(t,e,n,r){var i=n.min(r),o=n.max(r),s=new R(o.x,i.y),n=new R(i.x,o.y),r=U.intersectCircleLine(t,e,i,s),s=U.intersectCircleLine(t,e,s,o),o=U.intersectCircleLine(t,e,o,n),n=U.intersectCircleLine(t,e,n,i),i=new U("No Intersection");return i.appendPoints(r.points),i.appendPoints(s.points),i.appendPoints(o.points),i.appendPoints(n.points),0<i.points.length?i.status="Intersection":i.status=r.status,i},U.intersectEllipseEllipse=function(t,e,n,r,i,o){for(var s=[n*n,0,e*e,-2*n*n*t.x,-2*e*e*t.y,n*n*t.x*t.x+e*e*t.y*t.y-e*e*n*n],a=[o*o,0,i*i,-2*o*o*r.x,-2*i*i*r.y,o*o*r.x*r.x+i*i*r.y*r.y-i*i*o*o],u=U.bezout(s,a).getRoots(),c=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),h=.001*(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2]),l=new U("No Intersection"),y=0;y<u.length;y++)for(var p=new W(s[0],s[3]+u[y]*s[1],s[5]+u[y]*(s[4]+u[y]*s[2])).getRoots(),f=0;f<p.length;f++){var d=(s[0]*p[f]+s[1]*u[y]+s[3])*p[f]+(s[2]*u[y]+s[4])*u[y]+s[5];Math.abs(d)<c&&(d=(a[0]*p[f]+a[1]*u[y]+a[3])*p[f]+(a[2]*u[y]+a[4])*u[y]+a[5],Math.abs(d)<h&&l.appendPoint(new R(p[f],u[y])))}return 0<l.points.length&&(l.status="Intersection"),l},U.intersectEllipseLine=function(t,e,n,r,i){var o,s=new q(r.x,r.y),a=q.fromPoints(r,i),u=new q(t.x,t.y),s=s.subtract(u),u=new q(a.x/(e*e),a.y/(n*n)),n=new q(s.x/(e*e),s.y/(n*n)),u=a.dot(u),a=a.dot(n),n=a*a-u*(t=s.dot(n)-1);return n<0?o=new U("Outside"):0<n?(n=(-a+(t=Math.sqrt(n)))/u,((t=(-a-t)/u)<0||1<t)&&(n<0||1<n)?o=new U(t<0&&n<0||1<t&&1<n?"Outside":"Inside"):(o=new U("Intersection"),0<=t&&t<=1&&o.appendPoint(r.lerp(i,t)),0<=n&&n<=1&&o.appendPoint(r.lerp(i,n)))):0<=(u=-a/u)&&u<=1?(o=new U("Intersection")).appendPoint(r.lerp(i,u)):o=new U("Outside"),o},U.intersectEllipsePolygon=function(t,e,n,r){return this.intersectEllipsePolyline(t,e,n,o(r))},U.intersectEllipsePolyline=function(t,e,n,r){for(var i=new U("No Intersection"),o=r.length,s=0;s<o-1;s++){var a=r[s],u=r[s+1],u=U.intersectEllipseLine(t,e,n,a,u);i.appendPoints(u.points)}return 0<i.points.length&&(i.status="Intersection"),i},U.intersectEllipseRectangle=function(t,e,n,r,i){var o=r.min(i),s=r.max(i),a=new R(s.x,o.y),r=new R(o.x,s.y),i=U.intersectEllipseLine(t,e,n,o,a),a=U.intersectEllipseLine(t,e,n,a,s),s=U.intersectEllipseLine(t,e,n,s,r),r=U.intersectEllipseLine(t,e,n,r,o),o=new U("No Intersection");return o.appendPoints(i.points),o.appendPoints(a.points),o.appendPoints(s.points),o.appendPoints(r.points),0<o.points.length&&(o.status="Intersection"),o},U.intersectLineLine=function(t,e,n,r){var i,o=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),r=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);return 0!=r?(n=s/r,0<=(r=o/r)&&r<=1&&0<=n&&n<=1?(i=new U("Intersection")).points.push(new R(t.x+r*(e.x-t.x),t.y+r*(e.y-t.y))):i=new U("No Intersection")):i=new U(0==o||0==s?"Coincident":"Parallel"),i},U.intersectLinePolygon=function(t,e,n){return this.intersectLinePolyline(t,e,o(n))},U.intersectLinePolyline=function(t,e,n){for(var r=new U("No Intersection"),i=n.length,o=0;o<i-1;o++){var s=n[o],a=n[o+1],a=U.intersectLineLine(t,e,s,a);r.appendPoints(a.points)}return 0<r.points.length&&(r.status="Intersection"),r},U.intersectLineRectangle=function(t,e,n,r){var i=n.min(r),o=n.max(r),s=new R(o.x,i.y),n=new R(i.x,o.y),r=U.intersectLineLine(i,s,t,e),s=U.intersectLineLine(s,o,t,e),o=U.intersectLineLine(o,n,t,e),t=U.intersectLineLine(n,i,t,e),e=new U("No Intersection");return e.appendPoints(r.points),e.appendPoints(s.points),e.appendPoints(o.points),e.appendPoints(t.points),0<e.points.length&&(e.status="Intersection"),e},U.intersectPolygonPolygon=function(t,e){return this.intersectPolylinePolyline(o(t),o(e))},U.intersectPolygonPolyline=function(t,e){return this.intersectPolylinePolyline(o(t),e)},U.intersectPolygonRectangle=function(t,e,n){return this.intersectPolylineRectangle(o(t),e,n)},U.intersectPolylinePolyline=function(t,e){for(var n=new U("No Intersection"),r=t.length,i=0;i<r-1;i++){var o=t[i],s=t[i+1],s=U.intersectLinePolyline(o,s,e);n.appendPoints(s.points)}return 0<n.points.length&&(n.status="Intersection"),n},U.intersectPolylineRectangle=function(t,e,n){var r=e.min(n),i=e.max(n),o=new R(i.x,r.y),e=new R(r.x,i.y),n=U.intersectLinePolyline(r,o,t),o=U.intersectLinePolyline(o,i,t),i=U.intersectLinePolyline(i,e,t),r=U.intersectLinePolyline(e,r,t),t=new U("No Intersection");return t.appendPoints(n.points),t.appendPoints(o.points),t.appendPoints(i.points),t.appendPoints(r.points),0<t.points.length&&(t.status="Intersection"),t},U.intersectRectangleRectangle=function(t,e,n,r){var i=t.min(e),o=t.max(e),s=new R(o.x,i.y),t=new R(i.x,o.y),e=U.intersectLineRectangle(i,s,n,r),s=U.intersectLineRectangle(s,o,n,r),o=U.intersectLineRectangle(o,t,n,r),n=U.intersectLineRectangle(t,i,n,r),r=new U("No Intersection");return r.appendPoints(e.points),r.appendPoints(s.points),r.appendPoints(o.points),r.appendPoints(n.points),0<r.points.length&&(r.status="Intersection"),r},U.intersectRayRay=function(t,e,n,r){var i,o=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),n=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);return 0!=n?(n=o/n,(i=new U("Intersection")).points.push(new R(t.x+n*(e.x-t.x),t.y+n*(e.y-t.y)))):i=new U(0==o||0==s?"Coincident":"Parallel"),i},U.bezout=function(t,e){var n=t[0]*e[1]-e[0]*t[1],r=t[0]*e[2]-e[0]*t[2],i=t[0]*e[3]-e[0]*t[3],o=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],a=t[1]*e[2]-e[1]*t[2],u=t[1]*e[4]-e[1]*t[4],c=t[1]*e[5]-e[1]*t[5],h=t[2]*e[3]-e[2]*t[3],l=t[3]*e[4]-e[3]*t[4],t=t[3]*e[5]-e[3]*t[5],l=c+l,h=u-h;return new W(n*a-r*r,n*h+i*a-2*r*o,n*l+i*h-o*o-2*r*s,n*t+i*l-2*o*s,i*t-s*s)},t.exports=U}),h=e(function(t){function e(t,e){this.init(t,e)}e.prototype.init=function(t,e){this.name=t,this.args=e},t.exports=e}),d=(e(function(t){var u=n.Point2D,c=h,e={quadraticBezier:function(t,e,n,r,i,o){return new c("Bezier2",[new u(t,e),new u(n,r),new u(i,o)])},cubicBezier:function(t,e,n,r,i,o,s,a){return new c("Bezier3",[new u(t,e),new u(n,r),new u(i,o),new u(s,a)])},circle:function(t,e,n){return new c("Circle",[new u(t,e),n])},ellipse:function(t,e,n,r){return new c("Ellipse",[new u(t,e),n,r])},line:function(t,e,n,r){return new c("Line",[new u(t,e),new u(n,r)])},path:function(t){return new c("Path",t)},polygon:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new c("Polygon",[e])},polyline:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new c("Polyline",[e])},rectangle:function(t,e,n,r){return new c("Rectangle",[new u(t,e),new u(t+n,e+r)])}};t.exports=e}),e(function(t){var i=h,e={quadraticBezier:function(t,e,n){return new i("Bezier2",[t,e,n])},cubicBezier:function(t,e,n,r){return new i("Bezier3",[t,e,n,r])},circle:function(t,e){return new i("Circle",[t,e])},ellipse:function(t,e,n){return new i("Ellipse",[t,e,n])},line:function(t,e){return new i("Line",[t,e])},path:function(t){return new i("Path",[t])},polygon:function(t){return new i("Polygon",[t])},polyline:function(t){return new i("Polyline",[t])},rectangle:function(t,e){return new i("Rectangle",[t,t.add(e)])}};t.exports=e}),e(function(t){var r=n.Vector2D,e={pointInCircle:function(t,e,n){return r.fromPoints(e,t).length()<=n},pointInEllipse:function(t,e,n,r){e=t.subtract(e);return e.x*e.x/(n*n)+e.y*e.y/(r*r)<=1},pointInPolyline:function(t,e){for(var n=e.length,r=0,i=e[0],o=1;o<=n;o++){var s=e[o%n],a=Math.min(i.y,s.y),u=Math.max(i.y,s.y),c=Math.max(i.x,s.x);i.y!=s.y&&a<t.y&&t.y<=u&&t.x<=c&&(c=(t.y-i.y)*(s.x-i.x)/(s.y-i.y)+i.x,(i.x==s.x||t.x<=c)&&r++),i=s}return r%2==1}};e.pointInPolygon=e.pointInPolyline,e.pointInRectangle=function(t,e,n){return e.x<=t.x&&t.x<n.x&&e.y<=t.y&&t.y<n.y},t.exports=e}),a),Dt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x=e(function(t,e){var r="__lodash_hash_undefined__",v=1,d=2,y=9007199254740991,l="[object Arguments]",p="[object Array]",n="[object AsyncFunction]",f="[object Boolean]",x="[object Date]",g="[object Error]",i="[object Function]",o="[object GeneratorFunction]",m="[object Map]",_="[object Number]",s="[object Null]",b="[object Object]",a="[object Promise]",u="[object Proxy]",w="[object RegExp]",P="[object Set]",M="[object String]",I="[object Symbol]",c="[object Undefined]",h="[object WeakMap]",L="[object ArrayBuffer]",S="[object DataView]",j=/^\[object .+?Constructor\]$/,E=/^(?:0|[1-9]\d*)$/,R={};R["[object Float32Array]"]=R["[object Float64Array]"]=R["[object Int8Array]"]=R["[object Int16Array]"]=R["[object Int32Array]"]=R["[object Uint8Array]"]=R["[object Uint8ClampedArray]"]=R["[object Uint16Array]"]=R["[object Uint32Array]"]=!0,R[l]=R[p]=R[L]=R[f]=R[S]=R[x]=R[g]=R[i]=R[m]=R[_]=R[b]=R[w]=R[P]=R[M]=R[h]=!1;var T="object"==Dt(Ft)&&Ft&&Ft.Object===Object&&Ft,C="object"==("undefined"==typeof self?"undefined":Dt(self))&&self&&self.Object===Object&&self,N=T||C||Function("return this")(),z=e&&!e.nodeType&&e,O=z&&t&&!t.nodeType&&t,k=O&&O.exports===z,A=k&&T.process,C=function(){try{return A&&A.binding&&A.binding("util")}catch(t){}}(),e=C&&C.isTypedArray;function B(t){var n=-1,r=Array(t.size);return t.forEach(function(t,e){r[++n]=[e,t]}),r}function F(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var D,X,O=Array.prototype,z=Function.prototype,G=Object.prototype,T=N["__core-js_shared__"],q=z.toString,W=G.hasOwnProperty,U=(C=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||""))?"Symbol(src)_1."+C:"",$=G.toString,Y=RegExp("^"+q.call(W).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),z=k?N.Buffer:void 0,T=N.Symbol,V=N.Uint8Array,H=G.propertyIsEnumerable,Q=O.splice,Z=T?T.toStringTag:void 0,J=Object.getOwnPropertySymbols,C=z?z.isBuffer:void 0,K=(D=Object.keys,X=Object,function(t){return D(X(t))}),k=Mt(N,"DataView"),tt=Mt(N,"Map"),O=Mt(N,"Promise"),z=Mt(N,"Set"),N=Mt(N,"WeakMap"),et=Mt(Object,"create"),nt=St(k),rt=St(tt),it=St(O),ot=St(z),st=St(N),T=T?T.prototype:void 0,at=T?T.valueOf:void 0;function ut(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ct(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ht(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function lt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new ht;++e<n;)this.add(t[e])}function yt(t){t=this.__data__=new ct(t);this.size=t.size}function pt(t,e){var n,r,i,o=Rt(t),s=!o&&Et(t),a=!o&&!s&&Tt(t),u=!o&&!s&&!a&&At(t),c=o||s||a||u,h=c?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],l=h.length;for(n in t)!e&&!W.call(t,n)||c&&("length"==n||a&&("offset"==n||"parent"==n)||u&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||(r=n,!!(i=null==(i=l)?y:i)&&("number"==typeof r||E.test(r))&&-1<r&&r%1==0&&r<i))||h.push(n);return h}function ft(t,e){for(var n=t.length;n--;)if(jt(t[n][0],e))return n;return-1}function dt(t,e,n){e=e(t);return Rt(t)?e:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(e,n(t))}function xt(t){return null==t?void 0===t?c:s:Z&&Z in Object(t)?function(t){var e=W.call(t,Z),n=t[Z];try{var r=!(t[Z]=void 0)}catch(t){}var i=$.call(t);r&&(e?t[Z]=n:delete t[Z]);return i}(t):(t=t,$.call(t))}function gt(t){return Ot(t)&&xt(t)==l}function vt(t,e,n,r,i){return t===e||(null==t||null==e||!Ot(t)&&!Ot(e)?t!=t&&e!=e:function(t,e,n,r,i,o){var s=Rt(t),a=Rt(e),u=s?p:Lt(t),c=a?p:Lt(e),h=(u=u==l?b:u)==b,a=(c=c==l?b:c)==b,c=u==c;if(c&&Tt(t)){if(!Tt(e))return!1;h=!(s=!0)}if(c&&!h)return o=o||new yt,s||At(t)?bt(t,e,n,r,i,o):function(t,e,n,r,i,o,s){switch(n){case S:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case L:return t.byteLength==e.byteLength&&o(new V(t),new V(e))?!0:!1;case f:case x:case _:return jt(+t,+e);case g:return t.name==e.name&&t.message==e.message;case w:case M:return t==e+"";case m:var a=B;case P:var u=r&v;if(a=a||F,t.size!=e.size&&!u)return!1;u=s.get(t);if(u)return u==e;r|=d,s.set(t,e);a=bt(a(t),a(e),r,i,o,s);return s.delete(t),a;case I:if(at)return at.call(t)==at.call(e)}return!1}(t,e,u,n,r,i,o);if(!(n&v)){h=h&&W.call(t,"__wrapped__"),a=a&&W.call(e,"__wrapped__");if(h||a){h=h?t.value():t,a=a?e.value():e;return o=o||new yt,i(h,a,n,r,o)}}return c&&(o=o||new yt,function(t,e,n,r,i,o){var s=n&v,a=wt(t),u=a.length,c=wt(e).length;if(u!=c&&!s)return!1;var h=u;for(;h--;){var l=a[h];if(!(s?l in e:W.call(e,l)))return!1}var y=o.get(t);if(y&&o.get(e))return y==e;var p=!0;o.set(t,e),o.set(e,t);var f=s;for(;++h<u;){l=a[h];var d,x=t[l],g=e[l];if(!(void 0===(d=r?s?r(g,x,l,e,t,o):r(x,g,l,t,e,o):d)?x===g||i(x,g,n,r,o):d)){p=!1;break}f=f||"constructor"==l}p&&!f&&(c=t.constructor,y=e.constructor,c!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof c&&c instanceof c&&"function"==typeof y&&y instanceof y)&&(p=!1));return o.delete(t),o.delete(e),p}(t,e,n,r,i,o))}(t,e,n,r,vt,i))}function mt(t){var e;return zt(t)&&(e=t,!(U&&U in e))&&(Ct(t)?Y:j).test(St(t))}function _t(t){if(n="function"==typeof(n=(e=t)&&e.constructor)&&n.prototype||G,e!==n)return K(t);var e,n,r,i=[];for(r in Object(t))W.call(t,r)&&"constructor"!=r&&i.push(r);return i}function bt(t,e,r,i,o,s){var n=r&v,a=t.length,u=e.length;if(a!=u&&!(n&&a<u))return!1;u=s.get(t);if(u&&s.get(e))return u==e;var c=-1,h=!0,l=r&d?new lt:void 0;for(s.set(t,e),s.set(e,t);++c<a;){var y,p=t[c],f=e[c];if(void 0!==(y=i?n?i(f,p,c,e,t,s):i(p,f,c,t,e,s):y)){if(y)continue;h=!1;break}if(l){if(!function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return 1}(e,function(t,e){return n=e,!l.has(n)&&(p===t||o(p,t,r,i,s))&&l.push(e);var n})){h=!1;break}}else if(p!==f&&!o(p,f,r,i,s)){h=!1;break}}return s.delete(t),s.delete(e),h}function wt(t){return dt(t,Bt,It)}function Pt(t,e){var n,r=t.__data__;return("string"==(t=void 0===(n=e)?"undefined":Dt(n))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function Mt(t,e){e=e,e=null==(t=t)?void 0:t[e];return mt(e)?e:void 0}ut.prototype.clear=function(){this.__data__=et?et(null):{},this.size=0},ut.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},ut.prototype.get=function(t){var e=this.__data__;if(et){var n=e[t];return n===r?void 0:n}return W.call(e,t)?e[t]:void 0},ut.prototype.has=function(t){var e=this.__data__;return et?void 0!==e[t]:W.call(e,t)},ut.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=et&&void 0===e?r:e,this},ct.prototype.clear=function(){this.__data__=[],this.size=0},ct.prototype.delete=function(t){var e=this.__data__;return!((t=ft(e,t))<0)&&(t==e.length-1?e.pop():Q.call(e,t,1),--this.size,!0)},ct.prototype.get=function(t){var e=this.__data__;return(t=ft(e,t))<0?void 0:e[t][1]},ct.prototype.has=function(t){return-1<ft(this.__data__,t)},ct.prototype.set=function(t,e){var n=this.__data__,r=ft(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},ht.prototype.clear=function(){this.size=0,this.__data__={hash:new ut,map:new(tt||ct),string:new ut}},ht.prototype.delete=function(t){return t=Pt(this,t).delete(t),this.size-=t?1:0,t},ht.prototype.get=function(t){return Pt(this,t).get(t)},ht.prototype.has=function(t){return Pt(this,t).has(t)},ht.prototype.set=function(t,e){var n=Pt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},lt.prototype.add=lt.prototype.push=function(t){return this.__data__.set(t,r),this},lt.prototype.has=function(t){return this.__data__.has(t)},yt.prototype.clear=function(){this.__data__=new ct,this.size=0},yt.prototype.delete=function(t){var e=this.__data__,t=e.delete(t);return this.size=e.size,t},yt.prototype.get=function(t){return this.__data__.get(t)},yt.prototype.has=function(t){return this.__data__.has(t)},yt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ct){var r=n.__data__;if(!tt||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new ht(r)}return n.set(t,e),this.size=n.size,this};var It=J?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}(J(e),function(t){return H.call(e,t)}))}:function(){return[]},Lt=xt;function St(t){if(null!=t){try{return q.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function jt(t,e){return t===e||t!=t&&e!=e}(k&&Lt(new k(new ArrayBuffer(1)))!=S||tt&&Lt(new tt)!=m||O&&Lt(O.resolve())!=a||z&&Lt(new z)!=P||N&&Lt(new N)!=h)&&(Lt=function(t){var e=xt(t),t=e==b?t.constructor:void 0,t=t?St(t):"";if(t)switch(t){case nt:return S;case rt:return m;case it:return a;case ot:return P;case st:return h}return e});var Et=gt(function(){return arguments}())?gt:function(t){return Ot(t)&&W.call(t,"callee")&&!H.call(t,"callee")},Rt=Array.isArray;var Tt=C||function(){return!1};function Ct(t){if(zt(t)){t=xt(t);return t==i||t==o||t==n||t==u}}function Nt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=y}function zt(t){var e=void 0===t?"undefined":Dt(t);return null!=t&&("object"==e||"function"==e)}function Ot(t){return null!=t&&"object"==(void 0===t?"undefined":Dt(t))}var kt,At=e?(kt=e,function(t){return kt(t)}):function(t){return Ot(t)&&Nt(t.length)&&!!R[xt(t)]};function Bt(t){return(null!=(e=t)&&Nt(e.length)&&!Ct(e)?pt:_t)(t);var e}t.exports=function(t,e){return vt(t,e)}}),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c="__lodash_hash_undefined__",l=9007199254740991,p="[object Arguments]",f="[object Function]",g="[object GeneratorFunction]",v=/^\[object .+?Constructor\]$/,m="object"==u(Ft)&&Ft&&Ft.Object===Object&&Ft,_="object"==("undefined"==typeof self?"undefined":u(self))&&self&&self.Object===Object&&self,b=m||_||Function("return this")();function w(t,e){return!!(t?t.length:0)&&-1<function(t,e,n){if(e!=e)return function(t,e,n,r){var i=t.length,o=n+(r?1:-1);for(;r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}(t,M,n);var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,0)}function P(t,e,n){for(var r=-1,i=t?t.length:0;++r<i;)if(n(e,t[r]))return!0;return!1}function M(t){return t!=t}function I(t,e){return t.has(e)}function L(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var o=Array.prototype,a=Function.prototype,m=Object.prototype,_=b["__core-js_shared__"],S=(_=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+_:"",j=a.toString,E=m.hasOwnProperty,R=m.toString,T=RegExp("^"+j.call(E).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),a=b.Symbol,C=m.propertyIsEnumerable,N=o.splice,z=a?a.isConcatSpreadable:void 0,O=Math.max,k=V(b,"Map"),A=V(b,"Set"),B=V(Object,"create");function F(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function D(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function X(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function G(t){var e=-1,n=t?t.length:0;for(this.__data__=new X;++e<n;)this.add(t[e])}function q(t,e){for(var n,r,i=t.length;i--;)if((n=t[i][0])===(r=e)||n!=n&&r!=r)return i;return-1}function W(t,e,n,r,i){var o=-1,s=t.length;for(n=n||H,i=i||[];++o<s;){var a=t[o];0<e&&n(a)?1<e?W(a,e-1,n,r,i):function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n]}(i,a):r||(i[i.length]=a)}return i}function U(t){var e;return nt(t)&&(e=t,!(S&&S in e))&&(et(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?T:v).test(function(t){if(null!=t){try{return j.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t))}F.prototype.clear=function(){this.__data__=B?B(null):{}},F.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},F.prototype.get=function(t){var e=this.__data__;if(B){var n=e[t];return n===c?void 0:n}return E.call(e,t)?e[t]:void 0},F.prototype.has=function(t){var e=this.__data__;return B?void 0!==e[t]:E.call(e,t)},F.prototype.set=function(t,e){return this.__data__[t]=B&&void 0===e?c:e,this},D.prototype.clear=function(){this.__data__=[]},D.prototype.delete=function(t){var e=this.__data__;return!((t=q(e,t))<0)&&(t==e.length-1?e.pop():N.call(e,t,1),!0)},D.prototype.get=function(t){var e=this.__data__;return(t=q(e,t))<0?void 0:e[t][1]},D.prototype.has=function(t){return-1<q(this.__data__,t)},D.prototype.set=function(t,e){var n=this.__data__,r=q(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},X.prototype.clear=function(){this.__data__={hash:new F,map:new(k||D),string:new F}},X.prototype.delete=function(t){return Y(this,t).delete(t)},X.prototype.get=function(t){return Y(this,t).get(t)},X.prototype.has=function(t){return Y(this,t).has(t)},X.prototype.set=function(t,e){return Y(this,t).set(t,e),this},G.prototype.add=G.prototype.push=function(t){return this.__data__.set(t,c),this},G.prototype.has=function(t){return this.__data__.has(t)};var $=A&&1/L(new A([,-0]))[1]==1/0?function(t){return new A(t)}:function(){};function Y(t,e){var n,r=t.__data__;return("string"==(t=void 0===(n=e)?"undefined":u(n))||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==n:null===n)?r["string"==typeof e?"string":"hash"]:r.map}function V(t,e){e=e,e=null==(t=t)?void 0:t[e];return U(e)?e:void 0}function H(t){return J(t)||tt(e=t)&&E.call(e,"callee")&&(!C.call(e,"callee")||R.call(e)==p)||!!(z&&t&&t[z]);var e}var Q,Z,a=(Q=function(t){var e,n,n=(n=(e=t)?e.length:0)?e[n-1]:void 0;return tt(n)&&(n=void 0),function(t,e,n){var r=-1,i=w,o=t.length,s=!0,a=[],u=a;if(n)s=!1,i=P;else if(200<=o){var c=e?null:$(t);if(c)return L(c);s=!1,i=I,u=new G}else u=e?[]:a;t:for(;++r<o;){var h=t[r],l=e?e(h):h,h=n||0!==h?h:0;if(s&&l==l){for(var y=u.length;y--;)if(u[y]===l)continue t;e&&u.push(l),a.push(h)}else i(u,l,n)||(u!==a&&u.push(l),a.push(h))}return a}(W(t,1,tt,!0),void 0,n)},Z=O(void 0===Z?Q.length-1:Z,0),function(){for(var t=arguments,e=-1,n=O(t.length-Z,0),r=Array(n);++e<n;)r[e]=t[Z+e];for(var e=-1,i=Array(Z+1);++e<Z;)i[e]=t[e];return i[Z]=r,function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(Q,this,i)});var J=Array.isArray;function K(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=l)&&!et(t);var e}function tt(t){return!!(e=t)&&"object"==(void 0===e?"undefined":u(e))&&K(t);var e}function et(t){t=nt(t)?R.call(t):"";return t==f||t==g}function nt(t){var e=void 0===t?"undefined":u(t);return t&&("object"==e||"function"==e)}var rt=a,it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ot=9007199254740991,st="[object Arguments]",at="[object Function]",ut="[object GeneratorFunction]",b="object"==it(Ft)&&Ft&&Ft.Object===Object&&Ft,a="object"==("undefined"==typeof self?"undefined":it(self))&&self&&self.Object===Object&&self,b=b||a||Function("return this")();var a=Object.prototype,ct=a.hasOwnProperty,ht=a.toString,b=b.Symbol,lt=a.propertyIsEnumerable,yt=b?b.isConcatSpreadable:void 0;function pt(t,e,n,r,i){var o=-1,s=t.length;for(n=n||ft,i=i||[];++o<s;){var a=t[o];0<e&&n(a)?1<e?pt(a,e-1,n,r,i):function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n]}(i,a):r||(i[i.length]=a)}return i}function ft(t){return dt(t)||function(t){return function(t){return!!t&&"object"==(void 0===t?"undefined":it(t))}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=ot}(t.length)&&!function(t){t=function(t){var e=void 0===t?"undefined":it(t);return!!t&&("object"==e||"function"==e)}(t)?ht.call(t):"";return t==at||t==ut}(t)}(t)}(e=t)&&ct.call(e,"callee")&&(!lt.call(e,"callee")||ht.call(e)==st)||!!(yt&&t&&t[yt]);var e}var dt=Array.isArray;var xt=function(t){return(t?t.length:0)?pt(t,1/0):[]};function gt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r],o=Object.getOwnPropertyDescriptor(e,i);o&&o.configurable&&void 0===t[i]&&Object.defineProperty(t,i,o)}}(t,e))}var vt,b=(gt(mt,vt=maptalks.Class),mt.prototype.split=function(t,e){if(t instanceof maptalks.Polygon||t instanceof maptalks.LineString){if(this._initialTaskWithGeo(t),(e=e instanceof maptalks.LineString?[e]:e)instanceof Array&&0<e.length){this._splitWithTargets(e);e=this._result;return this.remove(),e}return this}},mt.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};this._splitWithTargets(),t(this._result,this._deals),this.remove()},mt.prototype.cancel=function(){this.remove()},mt.prototype.remove=function(){this._map;this._tmpLayer&&this._tmpLayer.remove(),this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._tmpLayer,delete this._chooseLayer,delete this._mousemove,delete this._click,delete this._dblclick},mt.prototype._initialTaskWithGeo=function(t){this._insureSafeTask(),this._savePrivateGeometry(t)},mt.prototype._insureSafeTask=function(){this.geometry&&this.remove()},mt.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t._layer,t.getType().startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(this.layer.map)},mt.prototype._addTo=function(t){return this._chooseLayer&&this.remove(),t._map_tool&&t._map_tool instanceof maptalks.DrawTool&&t._map_tool.disable(),this._map=t,this._tmpLayer=new maptalks.VectorLayer(this._layerTMP).addTo(t).bringToFront(),this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents(),this},mt.prototype._registerMapEvents=function(){var t,e=this;this._mousemove||(t=this._map,this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this))},mt.prototype._offMapEvents=function(){var t;this._mousemove&&((t=this._map).off("mousemove",this._mousemove,this),t.off("click",this._click,this))},mt.prototype._mousemoveEvents=function(t){var i=this,t=this.layer.identify(t.coordinate).reduce(function(t,e){if(!(e instanceof maptalks.LineString))return t;var n=i._getSafeCoords(),r=i._getSafeCoords(e);return x(r,n)?t:[].concat(t,[e])},[]);this._updateHitGeo(t)},mt.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates(),n=t.options||{},r=n.numberOfShellPoints;return r&&(n.numberOfShellPoints=300,t.setOptions(n),e=[t.getShell()],n.numberOfShellPoints=r||60,t.setOptions(n)),e},mt.prototype._updateHitGeo=function(t){var e;this._needRefreshSymbol&&((e=this._chooseLayer.getGeometryById("_hit"))&&(e.remove(),delete this.hitGeo),this._needRefreshSymbol=!1),t&&0<t.length&&(this._needRefreshSymbol=!0,this.hitGeo=t[0],t=this._getSymbolOrDefault(this.hitGeo,"Hit"),this._copyGeoUpdateSymbol(this.hitGeo,t).setId("_hit"))},mt.prototype._getSymbolOrDefault=function(t,e){var n=t.getSymbol(),r=this["_color"+e];if(n){for(var i in n)(i.endsWith("Fill")||i.endsWith("Color"))&&(n[i]=r);n.lineWidth=4}else n={lineColor:r,lineWidth:4};return n},mt.prototype._copyGeoUpdateSymbol=function(t,e){return t.copy().updateSymbol(e).addTo(this._chooseLayer)},mt.prototype._clickEvents=function(t){var e;this.hitGeo&&(e=this._getSafeCoords(this.hitGeo),this._setChooseGeosExceptHit(e),this._updateChooseGeos())},mt.prototype._setChooseGeosExceptHit=function(r){var i=this,t=this._chooseGeos.reduce(function(t,e){var n=i._getSafeCoords(e);return x(r,n)?t:[].concat(t,[e])},[]);t.length===this._chooseGeos.length?this._chooseGeos.push(this.hitGeo):this._chooseGeos=t},mt.prototype._updateChooseGeos=function(){var n=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=n._getSymbolOrDefault(t,"Choose");n._copyGeoUpdateSymbol(t,e)})},mt.prototype._splitWithTargets=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos;this.geometry&&(this._deals=this.options.deleteTargets?t:[],this.geometry instanceof maptalks.Polygon&&this._splitPolygonWithTargets(t),this.geometry instanceof maptalks.LineString&&this._splitLineWithTargets(t))},mt.prototype._splitPolygonWithTargets=function(t){var r=this,e=void 0;(t=this._getPolygonAvailTargets(t)).forEach(function(n){e=e?e.reduce(function(t,e){return r.geometry=e,[].concat(t,r._splitPolygonTargetBase(n))},[]):r._splitPolygonTargetBase(n),r.options.deleteTargets&&n.remove()}),this._result=e},mt.prototype._getPolygonAvailTargets=function(t){var n=this;return t.reduce(function(t,e){t=[].concat(t,n._getPolygonAvailTarget(e));return n.options.deleteTargets&&e.remove(),t},[])},mt.prototype._getPolygonAvailTarget=function(t){for(var e,n,r=[],i=[],o=!1,s=this._getSafeCoords(t),a=0;a<s.length;a++)o?(r=rt(r,[s[a]],x),n=this.geometry.containsPoint(s[a-1]),e=!this.geometry.containsPoint(s[a]),n&&e&&(o=!1,r=rt(r,[s[a]],x),i.push(r),r=[],a--)):s[a+1]&&(n=new maptalks.LineString([s[a],s[a+1]]),0<this._getPolygonPolylineIntersectPoints(n).length&&(e=!this.geometry.containsPoint(s[a]),n=this.geometry.containsPoint(s[a+1]),e&&n?(o=!0,r=rt(r,[s[a]],x)):i.push([s[a],s[a+1]])));return i.map(function(t){return new maptalks.LineString(t)})},mt.prototype._getPolygonPolylineIntersectPoints=function(t){var e=this._getPoint2dFromCoords(this.geometry),t=this._getPoint2dFromCoords(t);return d.intersectPolygonPolyline(e,t).points},mt.prototype._splitPolygonTargetBase=function(t){var e=this._getPolygonPolylineIntersectPoints(t),n=void 0;if(2===e.length)n=this._splitWithTargetMoreTwo(t);else{if(!(2===this._getSafeCoords(t).length&&2<e.length))return[this.geometry];n=this._splitWithTargetCommon(t)}return this.geometry.remove(),n},mt.prototype._splitWithTargetCommon=function(t){for(var e=this,n=this._getSafeCoords()[0],r=this._getPoint2dFromCoords(t),i=!0,o=[],s=[],a=[],u=0;u<n.length-1;u++){var c=new maptalks.LineString([n[u],n[u+1]]),h=this._getPoint2dFromCoords(c),c=d.intersectPolylinePolyline(r,h).points,h=this._getCoordsFromPoints(c)[0];x(n[u],h)||0<c.length?(i?(o.push(n[u],h),s.push(h)):(o.push(h),s.push(n[u],h),a.push(s),s=[]),i=!i):(i?o:s).push(n[u])}var l=[],y=this.geometry.getSymbol(),p=this.geometry.getProperties(),f=new maptalks.Polygon(o,{symbol:y,properties:p}).addTo(this.layer);return l.push(f),a.forEach(function(t){f=new maptalks.Polygon(t,{symbol:y,properties:p}).addTo(e.layer),l.push(f)}),l},mt.prototype._getPoint2dFromCoords=function(t){var e=this._map,n=e.getZoom(),t=this._getSafeCoords(t);return xt(t).map(function(t){return e.coordinateToPoint(t,n)})},mt.prototype._getCoordsFromPoints=function(t){t instanceof Array||(t=[t]);var e=this._map,n=e.getZoom();return t.map(function(t){return e.pointToCoordinate(t,n)})},mt.prototype._splitWithTargetMoreTwo=function(t){for(var e=this._getSafeCoords()[0],n=this._getPoint2dFromCoords(t),r=!0,i=[],o=[],s=[],a=0;a<e.length-1;a++){var u=new maptalks.LineString([e[a],e[a+1]]),c=this._getPoint2dFromCoords(u),h=d.intersectPolylinePolyline(n,c).points,u=this._getCoordsFromPoints(h),c=u[0];x(e[a],c)||0<h.length?(r?i.push(e[a],c):i.push(c),0===s.length&&0<(s=this._getTargetGap(t,h[0])).length&&(i.push.apply(i,s),o.push.apply(o,s.reverse())),r?o.push(c):o.push(e[a],c),1<u.length?(i.push(u[1]),o.push(u[1])):r=!r):(r?i:o).push(e[a])}var l=[],y=this.geometry.getSymbol(),p=this.geometry.getProperties(),f=new maptalks.Polygon(i,{symbol:y,properties:p}).addTo(this.layer);return l.push(f),f=new maptalks.Polygon(o,{symbol:y,properties:p}).addTo(this.layer),l.push(f),l},mt.prototype._getTargetGap=function(t,e){var n=this._getSafeCoords(t),r=(this._getPoint2dFromCoords(this.geometry),!1),i=[],o=void 0;this._tmpLayer.hide();for(var s=0;s<n.length-1;s++){r&&i.push(s);var a=new maptalks.LineString([n[s],n[s+1]]),a=this._getPolygonPolylineIntersectPoints(a);0<a.length&&(x(a[0],e)&&(o=s+1),r=!r)}return this._tmpLayer.clear().show(),i[0]!==o&&i.reverse(),i.map(function(t){return n[t]})},mt.prototype._splitLineWithTargets=function(t){var r=this;t=this._getLineAvailTargets(t);var e=void 0;t.forEach(function(n){e=e?e.reduce(function(t,e){return r.geometry=e,[].concat(t,r._splitLineTargetBase(n))},[]):r._splitLineTargetBase(n),r.options.deleteTargets&&n.remove()}),this._result=e},mt.prototype._splitLineTargetBase=function(t){for(var e,n=this,r=this._getPoint2dFromCoords(t),i=this._getSafeCoords(),o=[i[0]],s=[],a=0;a<i.length;a++)i[a+1]?(e=new maptalks.LineString([i[a],i[a+1]]),e=this._getPoint2dFromCoords(e),0<(e=d.intersectPolylinePolyline(r,e).points).length?(e=this._getCoordsFromPoints(e)[0],o.push(e),s.push(o),o=[e,i[a+1]]):o.push(i[a+1])):0<o.length&&(o.push(i[a]),s.push(o));t=s.map(function(t){return new maptalks.LineString(t).addTo(n.layer)});return this.geometry.remove(),t},mt.prototype._getLineAvailTargets=function(t){var n=this;return t.reduce(function(t,e){t=[].concat(t,n._getLineAvailTarget(e));return n.options.deleteTargets&&e.remove(),t},[])},mt.prototype._getLineAvailTarget=function(t){for(var e=[],n=this._getSafeCoords(t),r=0;r<n.length-1;r++){var i=new maptalks.LineString([n[r],n[r+1]]);0<this._getPolygonPolylineIntersectPoints(i).length&&e.push(i)}return e},mt);function mt(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,mt);t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,vt.call(this,t));return t._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",t._layerTMP=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP_TMP",t._chooseGeos=[],t._colorHit="#ffa400",t._colorChoose="#00bcd4",t}b.mergeOptions({deleteTargets:!0}),t.GeoSplit=b,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.geosplit v0.1.0, requires maptalks@>=0.31.0.")});