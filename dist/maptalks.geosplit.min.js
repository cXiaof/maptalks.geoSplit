/*!
 * maptalks.geosplit v0.1.0
 * LICENSE : MIT
 * (c) 2016-2019 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var te="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n={Point2D:e(function(t){function e(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}e.prototype.clone=function(){return new this.constructor(this.x,this.y)},e.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},e.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},e.prototype.lerp=function(t,e){var n=1-e;return new this.constructor(this.x*n+t.x*e,this.y*n+t.y*e)},e.prototype.distanceFrom=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},e.prototype.min=function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))},e.prototype.max=function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))},e.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)},e.prototype.toString=function(){return"point("+this.x+","+this.y+")"},t.exports=e}),Vector2D:e(function(t){function n(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}n.fromPoints=function(t,e){return new n(e.x-t.x,e.y-t.y)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.magnitude=function(){return this.x*this.x+this.y*this.y},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.determinant=function(t){return this.x*t.y-this.y*t.x},n.prototype.unit=function(){return this.divide(this.length())},n.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},n.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},n.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},n.prototype.angleBetween=function(t){var e=this.dot(t)/(this.length()*t.length());e=Math.max(-1,Math.min(e,1));var n=Math.acos(e);return this.cross(t)<0?-n:n},n.prototype.perp=function(){return new this.constructor(-this.y,this.x)},n.prototype.perpendicular=function(t){return this.subtract(this.project(t))},n.prototype.project=function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)},n.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)},n.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},n.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},n.prototype.toString=function(){return"vector("+this.x+","+this.y+")"},t.exports=n}),Matrix2D:e(function(t){function s(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,enumerable:!0,configurable:!1})}function i(t,e,n,r,i,o){s(this,"a",void 0!==t?t:1),s(this,"b",void 0!==e?e:0),s(this,"c",void 0!==n?n:0),s(this,"d",void 0!==r?r:1),s(this,"e",void 0!==i?i:0),s(this,"f",void 0!==o?o:0)}s(i,"IDENTITY",new i(1,0,0,1,0,0)),s(i.IDENTITY,"isIdentity",function(){return!0}),i.translation=function(t,e){return new i(1,0,0,1,t,e)},i.scaling=function(t){return new i(t,0,0,t,0,0)},i.scalingAt=function(t,e){return new i(t,0,0,t,e.x-e.x*t,e.y-e.y*t)},i.nonUniformScaling=function(t,e){return new i(t,0,0,e,0,0)},i.nonUniformScalingAt=function(t,e,n){return new i(t,0,0,e,n.x-n.x*t,n.y-n.y*e)},i.rotation=function(t){var e=Math.cos(t),n=Math.sin(t);return new i(e,n,-n,e,0,0)},i.rotationAt=function(t,e){var n=Math.cos(t),r=Math.sin(t);return new i(n,r,-r,n,e.x-e.x*n+e.y*r,e.y-e.y*n-e.x*r)},i.rotationFromVector=function(t){var e=t.unit(),n=e.x,r=e.y;return new i(n,r,-r,n,0,0)},i.xFlip=function(){return new i(-1,0,0,1,0,0)},i.yFlip=function(){return new i(1,0,0,-1,0,0)},i.xSkew=function(t){return new i(1,0,Math.tan(t),1,0,0)},i.ySkew=function(t){return new i(1,Math.tan(t),0,1,0,0)},i.prototype.multiply=function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)},i.prototype.inverse=function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0===t)throw"Matrix is not invertible";var e=1/t,n=this.f*this.c-this.e*this.d,r=this.e*this.b-this.f*this.a;return new this.constructor(this.d*e,-this.b*e,-this.c*e,this.a*e,n*e,r*e)},i.prototype.translate=function(t,e){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*e+this.e,this.b*t+this.d*e+this.f)},i.prototype.scale=function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)},i.prototype.scaleAt=function(t,e){var n=e.x-t*e.x,r=e.y-t*e.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*n+this.c*r+this.e,this.b*n+this.d*r+this.f)},i.prototype.scaleNonUniform=function(t,e){return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.e,this.f)},i.prototype.scaleNonUniformAt=function(t,e,n){var r=n.x-t*n.x,i=n.y-e*n.y;return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.a*r+this.c*i+this.e,this.b*r+this.d*i+this.f)},i.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t);return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.e,this.f)},i.prototype.rotateAt=function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x,o=e.y,s=this.a*n+this.c*r,a=this.b*n+this.d*r,u=this.c*n-this.a*r,c=this.d*n-this.b*r;return new this.constructor(s,a,u,c,(this.a-s)*i+(this.c-u)*o+this.e,(this.b-a)*i+(this.d-c)*o+this.f)},i.prototype.rotateFromVector=function(t){var e=t.unit(),n=e.x,r=e.y;return new this.constructor(this.a*n+this.c*r,this.b*n+this.d*r,this.a*-r+this.c*n,this.b*-r+this.d*n,this.e,this.f)},i.prototype.flipX=function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)},i.prototype.flipY=function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)},i.prototype.skewX=function(t){var e=Math.tan(t);return new this.constructor(this.a,this.b,this.c+this.a*e,this.d+this.b*e,this.e,this.f)},i.prototype.skewY=function(t){var e=Math.tan(t);return new this.constructor(this.a+this.c*e,this.b+this.d*e,this.c,this.d,this.e,this.f)},i.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},i.prototype.isInvertible=function(){return this.a*this.d-this.b*this.c!=0},i.prototype.getScale=function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}},i.prototype.getDecomposition=function(){var t=.5*(this.a+this.d),e=.5*(this.a-this.d),n=.5*(this.b+this.c),r=.5*(this.b-this.c),i=Math.sqrt(t*t+r*r),o=Math.sqrt(e*e+n*n),s=i+o,a=i-o,u=Math.atan2(n,e),c=Math.atan2(r,t),l=.5*(c-u),h=.5*(c+u);return{translation:new this.constructor(1,0,0,1,this.e,this.f),rotation:this.constructor.IDENTITY.rotate(h),scale:new this.constructor(s,0,0,a,0,0),rotation0:this.constructor.IDENTITY.rotate(l)}},i.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},i.prototype.precisionEquals=function(t,e){return Math.abs(this.a-t.a)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.c-t.c)<e&&Math.abs(this.d-t.d)<e&&Math.abs(this.e-t.e)<e&&Math.abs(this.f-t.f)<e},i.prototype.toString=function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"},t.exports=i})},r=e(function(t){function d(){this.init(arguments)}d.TOLERANCE=1e-6,d.ACCURACY=15,d.interpolate=function(t,e,n,r,i){if(t.constructor!==Array||e.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(r)||isNaN(i))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var o=0,s=0,a=new Array(n),u=new Array(n),c=0,l=Math.abs(i-t[r]),h=0;h<n;h++){var y=Math.abs(i-t[r+h]);y<l&&(c=h,l=y),a[h]=u[h]=e[r+h]}o=e[r+c],c--;for(var p=1;p<n;p++){for(h=0;h<n-p;h++){var f=t[r+h]-i,d=t[r+h+p]-i,x=a[h+1]-u[h],v=f-d;if(0==v)throw new Error("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");v=x/v,u[h]=d*v,a[h]=f*v}o+=s=2*(c+1)<n-p?a[c+1]:u[c--]}return{y:o,dy:s}},d.prototype.init=function(t){this.coefs=new Array;for(var e=t.length-1;0<=e;e--)this.coefs.push(t[e]);this._variable="t",this._s=0},d.prototype.eval=function(t){if(isNaN(t))throw new Error("Polynomial.eval: parameter must be a number");for(var e=0,n=this.coefs.length-1;0<=n;n--)e=e*t+this.coefs[n];return e},d.prototype.add=function(t){for(var e=new d,n=this.getDegree(),r=t.getDegree(),i=Math.max(n,r),o=0;o<=i;o++){var s=o<=n?this.coefs[o]:0,a=o<=r?t.coefs[o]:0;e.coefs[o]=s+a}return e},d.prototype.multiply=function(t){for(var e=new d,n=0;n<=this.getDegree()+t.getDegree();n++)e.coefs.push(0);for(n=0;n<=this.getDegree();n++)for(var r=0;r<=t.getDegree();r++)e.coefs[n+r]+=this.coefs[n]*t.coefs[r];return e},d.prototype.divide_scalar=function(t){for(var e=0;e<this.coefs.length;e++)this.coefs[e]/=t},d.prototype.simplify=function(t){void 0===t&&(t=1e-12);for(var e=this.getDegree();0<=e&&Math.abs(this.coefs[e])<=t;e--)this.coefs.pop()},d.prototype.bisection=function(t,e){var n,r=this.eval(t),i=this.eval(e);if(Math.abs(r)<=d.TOLERANCE)n=t;else if(Math.abs(i)<=d.TOLERANCE)n=e;else if(r*i<=0)for(var o=Math.log(e-t),s=Math.LN10*d.ACCURACY,a=Math.ceil((o+s)/Math.LN2),u=0;u<a;u++){n=.5*(t+e);var c=this.eval(n);if(Math.abs(c)<=d.TOLERANCE)break;c*r<0?(e=n,i=c):(t=n,r=c)}return n},d.prototype.toString=function(){for(var t=new Array,e=new Array,n=this.coefs.length-1;0<=n;n--){var r=Math.round(1e3*this.coefs[n])/1e3;if(0!=r){var i=r<0?" - ":" + ";r=Math.abs(r),0<n&&(1==r?r=this._variable:r+=this._variable),1<n&&(r+="^"+n),e.push(i),t.push(r)}}e[0]=" + "==e[0]?"":"-";var o="";for(n=0;n<t.length;n++)o+=e[n]+t[n];return o},d.prototype.trapezoid=function(t,e,n){if(isNaN(t)||isNaN(e)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var r=e-t;if(1==n){var i=this.eval(t),o=this.eval(e);this._s=.5*r*(i+o)}else{for(var s=1<<n-2,a=r/s,u=t+.5*a,c=0,l=0;l<s;l++)c+=this.eval(u),u+=a;this._s=.5*(this._s+r*c/s)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s},d.prototype.simpson=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.simpson: parameters must be numbers");for(var n=e-t,r=.5*n*(this.eval(t)+this.eval(e)),i=r,o=4*r/3,s=o,a=r,u=1,c=2;c<=20;c++){for(var l=n/u,h=t+.5*l,y=0,p=1;p<=u;p++)y+=this.eval(h),h+=l;if(o=(4*(r=i=.5*(i+n*y/u))-a)/3,Math.abs(o-s)<1e-7*Math.abs(s))break;s=o,a=r,u<<=1}return o},d.prototype.romberg=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.romberg: parameters must be numbers");for(var n=new Array(21),r=new Array(21),i={y:0,dy:0},o=r[0]=1;o<=20&&(n[o-1]=this.trapezoid(t,e,o),!(3<=o&&(i=d.interpolate(r,n,3,o-3,0),Math.abs(i.dy)<=1e-6*i.y)));o++)n[o]=n[o-1],r[o]=.25*r[o-1];return i.y},d.prototype.getDegree=function(){return this.coefs.length-1},d.prototype.getDerivative=function(){for(var t=new d,e=1;e<this.coefs.length;e++)t.coefs.push(e*this.coefs[e]);return t},d.prototype.getRoots=function(){var t;switch(this.simplify(),this.getDegree()){case 0:t=[];break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots();break;default:t=[]}return t},d.prototype.getRootsInInterval=function(t,e){var n,r=new Array;if(1==this.getDegree())null!=(n=this.bisection(t,e))&&r.push(n);else{var o=this.getDerivative().getRootsInInterval(t,e);if(0<o.length){for(null!=(n=this.bisection(t,o[0]))&&r.push(n),i=0;i<=o.length-2;i++)null!=(n=this.bisection(o[i],o[i+1]))&&r.push(n);null!=(n=this.bisection(o[o.length-1],e))&&r.push(n)}else null!=(n=this.bisection(t,e))&&r.push(n)}return r},d.prototype.getLinearRoot=function(){var t=[],e=this.coefs[1];return 0!=e&&t.push(-this.coefs[0]/e),t},d.prototype.getQuadraticRoots=function(){var t=[];if(2==this.getDegree()){var e=this.coefs[2],n=this.coefs[1]/e,r=n*n-4*(this.coefs[0]/e);if(0<r){var i=Math.sqrt(r);t.push(.5*(-n+i)),t.push(.5*(-n-i))}else 0==r&&t.push(.5*-n)}return t},d.prototype.getCubicRoots=function(){var t=[];if(3==this.getDegree()){var e=this.coefs[3],n=this.coefs[2]/e,r=this.coefs[1]/e,i=(3*r-n*n)/3,o=(2*n*n*n-9*r*n+27*(this.coefs[0]/e))/27,s=n/3,a=o*o/4+i*i*i/27,u=o/2,c=this.zeroErrorEstimate();if(Math.abs(a)<=c&&(a=0),0<a){var l,h=Math.sqrt(a);l=0<=(v=-u+h)?Math.pow(v,1/3):-Math.pow(-v,1/3),0<=(v=-u-h)?l+=Math.pow(v,1/3):l-=Math.pow(-v,1/3),t.push(l-s)}else if(a<0){var y=Math.sqrt(-i/3),p=Math.atan2(Math.sqrt(-a),-u)/3,f=Math.cos(p),d=Math.sin(p),x=Math.sqrt(3);t.push(2*y*f-s),t.push(-y*(f+x*d)-s),t.push(-y*(f-x*d)-s)}else{var v;v=0<=u?-Math.pow(u,1/3):Math.pow(-u,1/3),t.push(2*v-s),t.push(-v-s)}}return t};var b=function(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN};d.prototype.getQuarticRoots=function(){var t=[],e=this.getDegree();if(4==e){var n=new d;n.coefs=this.coefs.slice(),n.divide_scalar(n.coefs[e]);Math.abs(n.coefs[0])<10*1e-15*Math.abs(n.coefs[3])&&(n.coefs[0]=0);var r,i=n.getDerivative(),o=i.getRoots().sort(function(t,e){return t-e}),s=[],a=o.length-1,u=this.bounds();maxabsX=Math.max(Math.abs(u.minX),Math.abs(u.maxX));var c=this.zeroErrorEstimate(maxabsX);for(r=0;r<=a;r++)s.push(n.eval(o[r]));for(r=0;r<=a;r++)Math.abs(s[r])<c&&(s[r]=0);r=0;var l=Math.max(.1*(u.maxX-u.minX)/e,1e-15),h=[],y=[];if(-1<a){for(0!=s[0]?b(s[0])!=b(n.eval(o[0]-l)-s[0])&&(h.push(o[0]-l),y.push([u.minX,o[0]])):(t.push(o[0],o[0]),r++);r<a;r++)0==s[r+1]?(t.push(o[r+1],o[r+1]),r++):b(s[r])!=b(s[r+1])&&(h.push((o[r]+o[r+1])/2),y.push([o[r],o[r+1]]));0!=s[a]&&b(s[a])!=b(n.eval(o[a]+l)-s[a])&&(h.push(o[a]+l),y.push([o[a],u.maxX]))}var p=function(t){return n.eval(t)},f=function(t){return i.eval(t)};if(0<h.length)for(r=0;r<h.length;r++)h[r]=d.newton_secant_bisection(h[r],p,f,32,y[r][0],y[r][1]);t=t.concat(h)}return t},d.prototype.zeroErrorEstimate=function(i){var t=this;if(void 0===i){var e=t.bounds();i=Math.max(Math.abs(e.minX),Math.abs(e.maxX))}if(i<.001)return 2*Math.abs(t.eval(1e-15));var n=t.coefs.length-1,o=t.coefs[n];return 10*1e-15*t.coefs.reduce(function(t,e,n){var r=e/o*Math.pow(i,n);return t<r?r:t},0)},d.prototype.bounds_UpperReal_Fujiwara=function(){var e=this.coefs,n=e.length-1,r=e[n];1!=r&&(e=this.coefs.map(function(t){return t/r}));var i,t=e.map(function(t,e){return e<n?Math.pow(Math.abs(0==e?t/2:t),1/(n-e)):t}),o=function(t,e,n){return i(n)&&(t.max<e?(t.nearmax=t.max,t.max=e):t.nearmax<e&&(t.nearmax=e)),t};i=function(t){return t<n&&e[t]<0};var s=t.reduce(o,{max:0,nearmax:0});return i=function(t){return t<n&&(n%2==t%2?e[t]<0:0<e[t])},{negX:-2*t.reduce(o,{max:0,nearmax:0}).max,posX:2*s.max}},d.prototype.bounds_LowerReal_Fujiwara=function(){var t=new d;t.coefs=this.coefs.slice().reverse();var e=t.bounds_UpperReal_Fujiwara();return e.negX=1/e.negX,e.posX=1/e.posX,e},d.prototype.bounds=function(){var t=this.bounds_UpperReal_Fujiwara(),e={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX||(0===t.negX?e.minX=this.bounds_LowerReal_Fujiwara().posX:0===t.posX&&(e.maxX=this.bounds_LowerReal_Fujiwara().negX),e.minX>e.maxX&&(e.minX=e.maxX=0)),e},d.newton_secant_bisection=function(t,e,n,r,i,o){var s,a,u,c,l,h,p=0,f=0;s=t;var d=Math.pow(10,-14),x="number"==typeof i&&"number"==typeof o;if(x){if(o<i)throw new Error("newton root finding: min must be greater than max");if(l=e(i),h=e(o),b(l)==b(h))throw new Error("newton root finding: y values of bounds must be of opposite sign")}var v,g=function(){return Math.abs(u)<=d*Math.abs(s)||f==s-u-s};for(v=0;v<r;v++){if(0==(a=n(s))){if(0==p)throw new Error("newton root finding: df(x) is zero");a=p}if(p=a,y=e(s),u=y/a,c=s-u,g())break;if(x){if(b(y)==b(h))o=s,h=y;else{if(b(y)!=b(l)){s=c;break}i=s,l=y}if(c<i||o<c){if(b(l)==b(h))break;var m=h-l,_=o-i;if(u=0==m?s-(i+.5*_):50<Math.abs(m/Math.min(l,h))?s-(i+_*(.5+(Math.abs(l)<Math.abs(h)?-.25:.25))):s-(i-l/m*_),c=s-u,g())break}}f=s-c,s=c}return s},t.exports=d}),o=e(function(t){var e=r;function n(){this.init(arguments)}n.VERSION=1,((n.prototype=new e).constructor=n).superclass=e.prototype,n.prototype.eval=function(t){var e=n.superclass.eval.call(this,t);if(Math.abs(e)<1e-7&&(e=0),e<0)throw new Error("SqrtPolynomial.eval: cannot take square root of negative number");return Math.sqrt(e)},n.prototype.toString=function(){return"sqrt("+n.superclass.toString.call(this)+")"},t.exports=n}),s={Polynomial:r,SqrtPolynomial:o},a=e(function(t){var X=n.Point2D,tt=n.Vector2D,et=s.Polynomial;function o(t){var e=t.slice();return e.push(t[0]),e}function nt(t){this.init(t)}nt.prototype.init=function(t){this.status=t,this.points=new Array},nt.prototype.appendPoint=function(t){this.points.push(t)},nt.prototype.appendPoints=function(t){this.points=this.points.concat(t)},nt.intersect=function(t,e){var n;if(null!=t&&null!=e)if("Path"==t.name)n=nt.intersectPathShape(t,e);else if("Path"==e.name)n=nt.intersectPathShape(e,t);else{var r,i;if(t.name<e.name?(r="intersect"+t.name+e.name,i=t.args.concat(e.args)):(r="intersect"+e.name+t.name,i=e.args.concat(t.args)),!(r in nt))throw new Error("Intersection not available: "+r);n=nt[r].apply(null,i)}else n=new nt("No Intersection");return n},nt.intersectPathShape=function(t,e){for(var n=new nt("No Intersection"),r=t.args.length,i=0;i<r;i++){var o=t.args[i],s=nt.intersect(o,e);n.appendPoints(s.points)}return 0<n.points.length&&(n.status="Intersection"),n},nt.intersectBezier2Bezier2=function(t,e,n,r,i,o){var s,a,u,c,l,h,y=new nt("No Intersection");p=e.multiply(-2),s=t.add(p.add(n)),p=t.multiply(-2),f=e.multiply(2),a=p.add(f),u=new X(t.x,t.y),p=i.multiply(-2),c=r.add(p.add(o)),p=r.multiply(-2),f=i.multiply(2),l=p.add(f),h=new X(r.x,r.y);for(var p=s.x*a.y-a.x*s.y,f=c.x*a.y-a.x*c.y,d=l.x*a.y-a.x*l.y,x=a.x*(u.y-h.y)+a.y*(-u.x+h.x),v=c.x*s.y-s.x*c.y,g=l.x*s.y-s.x*l.y,m=s.x*(u.y-h.y)+s.y*(-u.x+h.x),_=new et(-v*v,-2*v*g,p*f-g*g-2*v*m,p*d-2*g*m,p*x-m*m).getRoots(),b=0;b<_.length;b++){var w=_[b];if(0<=w&&w<=1){var P=new et(s.x,a.x,u.x-h.x-w*l.x-w*w*c.x);P.simplify();var M=P.getRoots(),I=new et(s.y,a.y,u.y-h.y-w*l.y-w*w*c.y);I.simplify();var L=I.getRoots();if(0<M.length&&0<L.length){t:for(var S=0;S<M.length;S++){var j=M[S];if(0<=j&&j<=1)for(var E=0;E<L.length;E++)if(Math.abs(j-L[E])<1e-4){y.points.push(c.multiply(w*w).add(l.multiply(w).add(h)));break t}}}}}return 0<y.points.length&&(y.status="Intersection"),y},nt.intersectBezier2Bezier3=function(t,e,n,r,i,o,s){var a,u,c,l,h,y,p,f,d,x,v,g=new nt("No Intersection");a=e.multiply(-2),h=t.add(a.add(n)),a=t.multiply(-2),u=e.multiply(2),y=a.add(u),p=new X(t.x,t.y),a=r.multiply(-1),u=i.multiply(3),c=o.multiply(-3),l=a.add(u.add(c.add(s))),f=new tt(l.x,l.y),a=r.multiply(3),u=i.multiply(-6),c=o.multiply(3),l=a.add(u.add(c)),d=new tt(l.x,l.y),a=r.multiply(-3),u=i.multiply(3),c=a.add(u),x=new tt(c.x,c.y),v=new tt(r.x,r.y);for(var m=p.x*p.x,_=p.y*p.y,b=y.x*y.x,w=y.y*y.y,P=h.x*h.x,M=h.y*h.y,I=v.x*v.x,L=v.y*v.y,S=x.x*x.x,j=x.y*x.y,E=d.x*d.x,R=d.y*d.y,T=f.x*f.x,C=f.y*f.y,N=new et(-2*h.x*h.y*f.x*f.y+P*C+M*T,-2*h.x*h.y*d.x*f.y-2*h.x*h.y*d.y*f.x+2*M*d.x*f.x+2*P*d.y*f.y,-2*h.x*x.x*h.y*f.y-2*h.x*h.y*x.y*f.x-2*h.x*h.y*d.x*d.y+2*x.x*M*f.x+M*E+P*(2*x.y*f.y+R),2*p.x*h.x*h.y*f.y+2*p.y*h.x*h.y*f.x+y.x*y.y*h.x*f.y+y.x*y.y*h.y*f.x-2*v.x*h.x*h.y*f.y-2*h.x*v.y*h.y*f.x-2*h.x*x.x*h.y*d.y-2*h.x*h.y*x.y*d.x-2*p.x*M*f.x-2*p.y*P*f.y+2*v.x*M*f.x+2*x.x*M*d.x-w*h.x*f.x-b*h.y*f.y+P*(2*v.y*f.y+2*x.y*d.y),2*p.x*h.x*h.y*d.y+2*p.y*h.x*h.y*d.x+y.x*y.y*h.x*d.y+y.x*y.y*h.y*d.x-2*v.x*h.x*h.y*d.y-2*h.x*v.y*h.y*d.x-2*h.x*x.x*h.y*x.y-2*p.x*M*d.x-2*p.y*P*d.y+2*v.x*M*d.x-w*h.x*d.x-b*h.y*d.y+S*M+P*(2*v.y*d.y+j),2*p.x*h.x*h.y*x.y+2*p.y*h.x*x.x*h.y+y.x*y.y*h.x*x.y+y.x*y.y*x.x*h.y-2*v.x*h.x*h.y*x.y-2*h.x*v.y*x.x*h.y-2*p.x*x.x*M-2*p.y*P*x.y+2*v.x*x.x*M-w*h.x*x.x-b*h.y*x.y+2*P*v.y*x.y,-2*p.x*p.y*h.x*h.y-p.x*y.x*y.y*h.y-p.y*y.x*y.y*h.x+2*p.x*h.x*v.y*h.y+2*p.y*v.x*h.x*h.y+y.x*v.x*y.y*h.y+y.x*y.y*h.x*v.y-2*v.x*h.x*v.y*h.y-2*p.x*v.x*M+p.x*w*h.x+p.y*b*h.y-2*p.y*P*v.y-v.x*w*h.x-b*v.y*h.y+m*M+_*P+I*M+P*L).getRootsInInterval(0,1),z=0;z<N.length;z++){var O=N[z],A=new et(h.x,y.x,p.x-v.x-O*x.x-O*O*d.x-O*O*O*f.x).getRoots(),k=new et(h.y,y.y,p.y-v.y-O*x.y-O*O*d.y-O*O*O*f.y).getRoots();if(0<A.length&&0<k.length){t:for(var B=0;B<A.length;B++){var F=A[B];if(0<=F&&F<=1)for(var D=0;D<k.length;D++)if(Math.abs(F-k[D])<1e-4){g.points.push(f.multiply(O*O*O).add(d.multiply(O*O).add(x.multiply(O).add(v))));break t}}}}return 0<g.points.length&&(g.status="Intersection"),g},nt.intersectBezier2Circle=function(t,e,n,r,i){return nt.intersectBezier2Ellipse(t,e,n,r,i,i)},nt.intersectBezier2Ellipse=function(t,e,n,r,i,o){var s,a,u,c,l,h=new nt("No Intersection");s=e.multiply(-2),u=t.add(s.add(n)),s=t.multiply(-2),a=e.multiply(2),c=s.add(a),l=new X(t.x,t.y);for(var y=i*i,p=o*o,f=new et(p*u.x*u.x+y*u.y*u.y,2*(p*u.x*c.x+y*u.y*c.y),p*(2*u.x*l.x+c.x*c.x)+y*(2*u.y*l.y+c.y*c.y)-2*(p*r.x*u.x+y*r.y*u.y),2*(p*c.x*(l.x-r.x)+y*c.y*(l.y-r.y)),p*(l.x*l.x+r.x*r.x)+y*(l.y*l.y+r.y*r.y)-2*(p*r.x*l.x+y*r.y*l.y)-y*p).getRoots(),d=0;d<f.length;d++){var x=f[d];0<=x&&x<=1&&h.points.push(u.multiply(x*x).add(c.multiply(x).add(l)))}return 0<h.points.length&&(h.status="Intersection"),h},nt.intersectBezier2Line=function(t,e,n,r,i){var o,s,a,u,c,l,h,y=r.min(i),p=r.max(i),f=new nt("No Intersection");o=e.multiply(-2),a=t.add(o.add(n)),o=t.multiply(-2),s=e.multiply(2),u=o.add(s),c=new X(t.x,t.y),h=new tt(r.y-i.y,i.x-r.x),l=r.x*i.y-i.x*r.y,roots=new et(h.dot(a),h.dot(u),h.dot(c)+l).getRoots();for(var d=0;d<roots.length;d++){var x=roots[d];if(0<=x&&x<=1){var v=t.lerp(e,x),g=e.lerp(n,x),m=v.lerp(g,x);r.x==i.x?y.y<=m.y&&m.y<=p.y&&(f.status="Intersection",f.appendPoint(m)):r.y==i.y?y.x<=m.x&&m.x<=p.x&&(f.status="Intersection",f.appendPoint(m)):y.x<=m.x&&m.x<=p.x&&y.y<=m.y&&m.y<=p.y&&(f.status="Intersection",f.appendPoint(m))}}return f},nt.intersectBezier2Polygon=function(t,e,n,r){return nt.intersectBezier2Polyline(t,e,n,o(r))},nt.intersectBezier2Polyline=function(t,e,n,r){for(var i=new nt("No Intersection"),o=r.length,s=0;s<o-1;s++){var a=r[s],u=r[s+1],c=nt.intersectBezier2Line(t,e,n,a,u);i.appendPoints(c.points)}return 0<i.points.length&&(i.status="Intersection"),i},nt.intersectBezier2Rectangle=function(t,e,n,r,i){var o=r.min(i),s=r.max(i),a=new X(s.x,o.y),u=new X(o.x,s.y),c=nt.intersectBezier2Line(t,e,n,o,a),l=nt.intersectBezier2Line(t,e,n,a,s),h=nt.intersectBezier2Line(t,e,n,s,u),y=nt.intersectBezier2Line(t,e,n,u,o),p=new nt("No Intersection");return p.appendPoints(c.points),p.appendPoints(l.points),p.appendPoints(h.points),p.appendPoints(y.points),0<p.points.length&&(p.status="Intersection"),p},nt.intersectBezier3Bezier3=function(t,e,n,r,i,o,s,a){var u,c,l,h,y,p,f,d,x,v=new nt("No Intersection");g=t.multiply(-1),m=e.multiply(3),u=n.multiply(-3),M=g.add(m.add(u.add(r))),c=new tt(M.x,M.y),g=t.multiply(3),m=e.multiply(-6),u=n.multiply(3),M=g.add(m.add(u)),l=new tt(M.x,M.y),g=t.multiply(-3),m=e.multiply(3),u=g.add(m),h=new tt(u.x,u.y),y=new tt(t.x,t.y),g=i.multiply(-1),m=o.multiply(3),u=s.multiply(-3),M=g.add(m.add(u.add(a))),p=new tt(M.x,M.y),g=i.multiply(3),m=o.multiply(-6),u=s.multiply(3),M=g.add(m.add(u)),f=new tt(M.x,M.y),g=i.multiply(-3),m=o.multiply(3),u=g.add(m),d=new tt(u.x,u.y),x=new tt(i.x,i.y);var g=c.x*l.y-l.x*c.y,m=c.x*h.y-h.x*c.y,_=c.x*y.y-y.x*c.y+x.x*c.y-c.x*x.y,b=d.x*c.y-c.x*d.y,w=f.x*c.y-c.x*f.y,P=p.x*c.y-c.x*p.y,M=c.x*h.y-h.x*c.y,I=c.x*y.y+l.x*h.y-h.x*l.y-y.x*c.y+x.x*c.y-c.x*x.y,L=d.x*c.y-c.x*d.y,S=f.x*c.y-c.x*f.y,j=p.x*c.y-c.x*p.y,E=l.x*y.y-y.x*l.y+x.x*l.y-l.x*x.y,R=d.x*l.y-l.x*d.y,T=f.x*l.y-l.x*f.y,C=p.x*l.y-l.x*p.y,N=c.x*y.y-y.x*c.y+x.x*c.y-c.x*x.y,z=d.x*c.y-c.x*d.y,O=f.x*c.y-c.x*f.y,A=p.x*c.y-c.x*p.y,k=l.x*y.y-y.x*l.y+x.x*l.y-l.x*x.y,B=d.x*l.y-l.x*d.y,F=f.x*l.y-l.x*f.y,D=p.x*l.y-l.x*p.y,X=h.x*y.y-y.x*h.y+x.x*h.y-h.x*x.y,G=d.x*h.y-h.x*d.y,q=f.x*h.y-h.x*f.y,W=p.x*h.y-h.x*p.y,U=new et(-P*j*A,-P*j*O-P*S*A-w*j*A,-P*j*z-P*S*O-w*j*O-P*L*A-w*S*A-b*j*A,-P*j*N-P*S*z-w*j*z-P*L*O-w*S*O-b*j*O-P*I*A-w*L*A-b*S*A-_*j*A+m*C*A+P*M*D-g*C*D+g*j*W,-P*S*N-w*j*N-P*L*z-w*S*z-b*j*z-P*I*O-w*L*O-b*S*O-_*j*O+m*C*O-w*I*A-b*L*A-_*S*A+m*T*A+P*M*F-g*C*F+w*M*D-g*T*D+g*j*q+g*S*W,-P*L*N-w*S*N-b*j*N-P*I*z-w*L*z-b*S*z-_*j*z+m*C*z-w*I*O-b*L*O-_*S*O+m*T*O-b*I*A-_*L*A+m*R*A+P*M*B-g*C*B+w*M*F-g*T*F+b*M*D-g*R*D+g*j*G+g*S*q+g*L*W,-P*I*N-w*L*N-b*S*N-_*j*N+m*C*N-w*I*z-b*L*z-_*S*z+m*T*z-b*I*O-_*L*O+m*R*O-_*I*A+m*E*A+P*M*k-g*C*k+w*M*B-g*T*B+b*M*F-g*R*F+_*M*D-g*E*D+g*j*X+g*S*G+g*L*q-m*M*W+g*I*W,-w*I*N-b*L*N-_*S*N+m*T*N-b*I*z-_*L*z+m*R*z-_*I*O+m*E*O+w*M*k-g*T*k+b*M*B-g*R*B+_*M*F-g*E*F+g*S*X+g*L*G-m*M*q+g*I*q,-b*I*N-_*L*N+m*R*N-_*I*z+m*E*z+b*M*k-g*R*k+_*M*B-g*E*B+g*L*X-m*M*G+g*I*G,-_*I*N+m*E*N+_*M*k-g*E*k-m*M*X+g*I*X);U.simplify();for(var $=U.getRootsInInterval(0,1),Y=0;Y<$.length;Y++){var V=$[Y],H=new et(c.x,l.x,h.x,y.x-x.x-V*d.x-V*V*f.x-V*V*V*p.x);H.simplify(),xRoots=H.getRoots();var Q=new et(c.y,l.y,h.y,y.y-x.y-V*d.y-V*V*f.y-V*V*V*p.y);if(Q.simplify(),yRoots=Q.getRoots(),0<xRoots.length&&0<yRoots.length){t:for(var Z=0;Z<xRoots.length;Z++){var J=xRoots[Z];if(0<=J&&J<=1)for(var K=0;K<yRoots.length;K++)if(Math.abs(J-yRoots[K])<1e-4){v.points.push(p.multiply(V*V*V).add(f.multiply(V*V).add(d.multiply(V).add(x))));break t}}}}return 0<v.points.length&&(v.status="Intersection"),v},nt.intersectBezier3Circle=function(t,e,n,r,i,o){return nt.intersectBezier3Ellipse(t,e,n,r,i,o,o)},nt.intersectBezier3Ellipse=function(t,e,n,r,i,o,s){var a,u,c,l,h,y,p,f,d=new nt("No Intersection");a=t.multiply(-1),u=e.multiply(3),c=n.multiply(-3),l=a.add(u.add(c.add(r))),h=new tt(l.x,l.y),a=t.multiply(3),u=e.multiply(-6),c=n.multiply(3),l=a.add(u.add(c)),y=new tt(l.x,l.y),a=t.multiply(-3),u=e.multiply(3),c=a.add(u),p=new tt(c.x,c.y),f=new tt(t.x,t.y);for(var x=o*o,v=s*s,g=new et(h.x*h.x*v+h.y*h.y*x,2*(h.x*y.x*v+h.y*y.y*x),2*(h.x*p.x*v+h.y*p.y*x)+y.x*y.x*v+y.y*y.y*x,2*h.x*v*(f.x-i.x)+2*h.y*x*(f.y-i.y)+2*(y.x*p.x*v+y.y*p.y*x),2*y.x*v*(f.x-i.x)+2*y.y*x*(f.y-i.y)+p.x*p.x*v+p.y*p.y*x,2*p.x*v*(f.x-i.x)+2*p.y*x*(f.y-i.y),f.x*f.x*v-2*f.y*i.y*x-2*f.x*i.x*v+f.y*f.y*x+i.x*i.x*v+i.y*i.y*x-x*v).getRootsInInterval(0,1),m=0;m<g.length;m++){var _=g[m];d.points.push(h.multiply(_*_*_).add(y.multiply(_*_).add(p.multiply(_).add(f))))}return 0<d.points.length&&(d.status="Intersection"),d},nt.intersectBezier3Line=function(t,e,n,r,i,o){var s,a,u,c,l,h,y,p,f,d,x=i.min(o),v=i.max(o),g=new nt("No Intersection");s=t.multiply(-1),a=e.multiply(3),u=n.multiply(-3),c=s.add(a.add(u.add(r))),l=new tt(c.x,c.y),s=t.multiply(3),a=e.multiply(-6),u=n.multiply(3),c=s.add(a.add(u)),h=new tt(c.x,c.y),s=t.multiply(-3),a=e.multiply(3),u=s.add(a),y=new tt(u.x,u.y),p=new tt(t.x,t.y),d=new tt(i.y-o.y,o.x-i.x),f=i.x*o.y-o.x*i.y,roots=new et(d.dot(l),d.dot(h),d.dot(y),d.dot(p)+f).getRoots();for(var m=0;m<roots.length;m++){var _=roots[m];if(0<=_&&_<=1){var b=t.lerp(e,_),w=e.lerp(n,_),P=n.lerp(r,_),M=b.lerp(w,_),I=w.lerp(P,_),L=M.lerp(I,_);i.x==o.x?x.y<=L.y&&L.y<=v.y&&(g.status="Intersection",g.appendPoint(L)):i.y==o.y?x.x<=L.x&&L.x<=v.x&&(g.status="Intersection",g.appendPoint(L)):x.x<=L.x&&L.x<=v.x&&x.y<=L.y&&L.y<=v.y&&(g.status="Intersection",g.appendPoint(L))}}return g},nt.intersectBezier3Polygon=function(t,e,n,r,i){return this.intersectBezier3Polyline(t,e,n,r,o(i))},nt.intersectBezier3Polyline=function(t,e,n,r,i){for(var o=new nt("No Intersection"),s=i.length,a=0;a<s-1;a++){var u=i[a],c=i[a+1],l=nt.intersectBezier3Line(t,e,n,r,u,c);o.appendPoints(l.points)}return 0<o.points.length&&(o.status="Intersection"),o},nt.intersectBezier3Rectangle=function(t,e,n,r,i,o){var s=i.min(o),a=i.max(o),u=new X(a.x,s.y),c=new X(s.x,a.y),l=nt.intersectBezier3Line(t,e,n,r,s,u),h=nt.intersectBezier3Line(t,e,n,r,u,a),y=nt.intersectBezier3Line(t,e,n,r,a,c),p=nt.intersectBezier3Line(t,e,n,r,c,s),f=new nt("No Intersection");return f.appendPoints(l.points),f.appendPoints(h.points),f.appendPoints(y.points),f.appendPoints(p.points),0<f.points.length&&(f.status="Intersection"),f},nt.intersectCircleCircle=function(t,e,n,r){var i,o=e+r,s=Math.abs(e-r),a=t.distanceFrom(n);if(o<a)i=new nt("Outside");else if(a<s)i=new nt("Inside");else{i=new nt("Intersection");var u=(e*e-r*r+a*a)/(2*a),c=Math.sqrt(e*e-u*u),l=t.lerp(n,u/a),h=c/a;i.points.push(new X(l.x-h*(n.y-t.y),l.y+h*(n.x-t.x))),i.points.push(new X(l.x+h*(n.y-t.y),l.y-h*(n.x-t.x)))}return i},nt.intersectCircleEllipse=function(t,e,n,r,i){return nt.intersectEllipseEllipse(t,e,e,n,r,i)},nt.intersectCircleLine=function(t,e,n,r){var i,o=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),s=2*((r.x-n.x)*(n.x-t.x)+(r.y-n.y)*(n.y-t.y)),a=s*s-4*o*(t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-e*e);if(a<0)i=new nt("Outside");else if(0==a)i=new nt("Tangent");else{var u=Math.sqrt(a),c=(-s+u)/(2*o),l=(-s-u)/(2*o);(c<0||1<c)&&(l<0||1<l)?i=new nt(c<0&&l<0||1<c&&1<l?"Outside":"Inside"):(i=new nt("Intersection"),0<=c&&c<=1&&i.points.push(n.lerp(r,c)),0<=l&&l<=1&&i.points.push(n.lerp(r,l)))}return i},nt.intersectCirclePolygon=function(t,e,n){return this.intersectCirclePolyline(t,e,o(n))},nt.intersectCirclePolyline=function(t,e,n){for(var r,i=new nt("No Intersection"),o=n.length,s=0;s<o-1;s++){var a=n[s],u=n[s+1];r=nt.intersectCircleLine(t,e,a,u),i.appendPoints(r.points)}return 0<i.points.length?i.status="Intersection":i.status=r.status,i},nt.intersectCircleRectangle=function(t,e,n,r){var i=n.min(r),o=n.max(r),s=new X(o.x,i.y),a=new X(i.x,o.y),u=nt.intersectCircleLine(t,e,i,s),c=nt.intersectCircleLine(t,e,s,o),l=nt.intersectCircleLine(t,e,o,a),h=nt.intersectCircleLine(t,e,a,i),y=new nt("No Intersection");return y.appendPoints(u.points),y.appendPoints(c.points),y.appendPoints(l.points),y.appendPoints(h.points),0<y.points.length?y.status="Intersection":y.status=u.status,y},nt.intersectEllipseEllipse=function(t,e,n,r,i,o){for(var s=[n*n,0,e*e,-2*n*n*t.x,-2*e*e*t.y,n*n*t.x*t.x+e*e*t.y*t.y-e*e*n*n],a=[o*o,0,i*i,-2*o*o*r.x,-2*i*i*r.y,o*o*r.x*r.x+i*i*r.y*r.y-i*i*o*o],u=nt.bezout(s,a).getRoots(),c=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),l=.001*(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2]),h=new nt("No Intersection"),y=0;y<u.length;y++)for(var p=new et(s[0],s[3]+u[y]*s[1],s[5]+u[y]*(s[4]+u[y]*s[2])).getRoots(),f=0;f<p.length;f++){var d=(s[0]*p[f]+s[1]*u[y]+s[3])*p[f]+(s[2]*u[y]+s[4])*u[y]+s[5];Math.abs(d)<c&&(d=(a[0]*p[f]+a[1]*u[y]+a[3])*p[f]+(a[2]*u[y]+a[4])*u[y]+a[5],Math.abs(d)<l&&h.appendPoint(new X(p[f],u[y])))}return 0<h.points.length&&(h.status="Intersection"),h},nt.intersectEllipseLine=function(t,e,n,r,i){var o,s=new tt(r.x,r.y),a=tt.fromPoints(r,i),u=new tt(t.x,t.y),c=s.subtract(u),l=new tt(a.x/(e*e),a.y/(n*n)),h=new tt(c.x/(e*e),c.y/(n*n)),y=a.dot(l),p=a.dot(h),f=p*p-y*(t=c.dot(h)-1);if(f<0)o=new nt("Outside");else if(0<f){var d=Math.sqrt(f),x=(-p-d)/y,v=(-p+d)/y;(x<0||1<x)&&(v<0||1<v)?o=new nt(x<0&&v<0||1<x&&1<v?"Outside":"Inside"):(o=new nt("Intersection"),0<=x&&x<=1&&o.appendPoint(r.lerp(i,x)),0<=v&&v<=1&&o.appendPoint(r.lerp(i,v)))}else{var g=-p/y;0<=g&&g<=1?(o=new nt("Intersection")).appendPoint(r.lerp(i,g)):o=new nt("Outside")}return o},nt.intersectEllipsePolygon=function(t,e,n,r){return this.intersectEllipsePolyline(t,e,n,o(r))},nt.intersectEllipsePolyline=function(t,e,n,r){for(var i=new nt("No Intersection"),o=r.length,s=0;s<o-1;s++){var a=r[s],u=r[s+1],c=nt.intersectEllipseLine(t,e,n,a,u);i.appendPoints(c.points)}return 0<i.points.length&&(i.status="Intersection"),i},nt.intersectEllipseRectangle=function(t,e,n,r,i){var o=r.min(i),s=r.max(i),a=new X(s.x,o.y),u=new X(o.x,s.y),c=nt.intersectEllipseLine(t,e,n,o,a),l=nt.intersectEllipseLine(t,e,n,a,s),h=nt.intersectEllipseLine(t,e,n,s,u),y=nt.intersectEllipseLine(t,e,n,u,o),p=new nt("No Intersection");return p.appendPoints(c.points),p.appendPoints(l.points),p.appendPoints(h.points),p.appendPoints(y.points),0<p.points.length&&(p.status="Intersection"),p},nt.intersectLineLine=function(t,e,n,r){var i,o=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),a=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!=a){var u=o/a,c=s/a;0<=u&&u<=1&&0<=c&&c<=1?(i=new nt("Intersection")).points.push(new X(t.x+u*(e.x-t.x),t.y+u*(e.y-t.y))):i=new nt("No Intersection")}else i=new nt(0==o||0==s?"Coincident":"Parallel");return i},nt.intersectLinePolygon=function(t,e,n){return this.intersectLinePolyline(t,e,o(n))},nt.intersectLinePolyline=function(t,e,n){for(var r=new nt("No Intersection"),i=n.length,o=0;o<i-1;o++){var s=n[o],a=n[o+1],u=nt.intersectLineLine(t,e,s,a);r.appendPoints(u.points)}return 0<r.points.length&&(r.status="Intersection"),r},nt.intersectLineRectangle=function(t,e,n,r){var i=n.min(r),o=n.max(r),s=new X(o.x,i.y),a=new X(i.x,o.y),u=nt.intersectLineLine(i,s,t,e),c=nt.intersectLineLine(s,o,t,e),l=nt.intersectLineLine(o,a,t,e),h=nt.intersectLineLine(a,i,t,e),y=new nt("No Intersection");return y.appendPoints(u.points),y.appendPoints(c.points),y.appendPoints(l.points),y.appendPoints(h.points),0<y.points.length&&(y.status="Intersection"),y},nt.intersectPolygonPolygon=function(t,e){return this.intersectPolylinePolyline(o(t),o(e))},nt.intersectPolygonPolyline=function(t,e){return this.intersectPolylinePolyline(o(t),e)},nt.intersectPolygonRectangle=function(t,e,n){return this.intersectPolylineRectangle(o(t),e,n)},nt.intersectPolylinePolyline=function(t,e){for(var n=new nt("No Intersection"),r=t.length,i=0;i<r-1;i++){var o=t[i],s=t[i+1],a=nt.intersectLinePolyline(o,s,e);n.appendPoints(a.points)}return 0<n.points.length&&(n.status="Intersection"),n},nt.intersectPolylineRectangle=function(t,e,n){var r=e.min(n),i=e.max(n),o=new X(i.x,r.y),s=new X(r.x,i.y),a=nt.intersectLinePolyline(r,o,t),u=nt.intersectLinePolyline(o,i,t),c=nt.intersectLinePolyline(i,s,t),l=nt.intersectLinePolyline(s,r,t),h=new nt("No Intersection");return h.appendPoints(a.points),h.appendPoints(u.points),h.appendPoints(c.points),h.appendPoints(l.points),0<h.points.length&&(h.status="Intersection"),h},nt.intersectRectangleRectangle=function(t,e,n,r){var i=t.min(e),o=t.max(e),s=new X(o.x,i.y),a=new X(i.x,o.y),u=nt.intersectLineRectangle(i,s,n,r),c=nt.intersectLineRectangle(s,o,n,r),l=nt.intersectLineRectangle(o,a,n,r),h=nt.intersectLineRectangle(a,i,n,r),y=new nt("No Intersection");return y.appendPoints(u.points),y.appendPoints(c.points),y.appendPoints(l.points),y.appendPoints(h.points),0<y.points.length&&(y.status="Intersection"),y},nt.intersectRayRay=function(t,e,n,r){var i,o=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),a=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!=a){var u=o/a;(i=new nt("Intersection")).points.push(new X(t.x+u*(e.x-t.x),t.y+u*(e.y-t.y)))}else i=new nt(0==o||0==s?"Coincident":"Parallel");return i},nt.bezout=function(t,e){var n=t[0]*e[1]-e[0]*t[1],r=t[0]*e[2]-e[0]*t[2],i=t[0]*e[3]-e[0]*t[3],o=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],a=t[1]*e[2]-e[1]*t[2],u=t[1]*e[4]-e[1]*t[4],c=t[1]*e[5]-e[1]*t[5],l=t[2]*e[3]-e[2]*t[3],h=t[3]*e[4]-e[3]*t[4],y=t[3]*e[5]-e[3]*t[5],p=c+h,f=u-l;return new et(n*a-r*r,n*f+i*a-2*r*o,n*p+i*f-o*o-2*r*s,n*y+i*p-2*o*s,i*y-s*s)},t.exports=nt}),l=e(function(t){function e(t,e){this.init(t,e)}e.prototype.init=function(t,e){this.name=t,this.args=e},t.exports=e}),v=(e(function(t){var u=n.Point2D,c=l,e={quadraticBezier:function(t,e,n,r,i,o){return new c("Bezier2",[new u(t,e),new u(n,r),new u(i,o)])},cubicBezier:function(t,e,n,r,i,o,s,a){return new c("Bezier3",[new u(t,e),new u(n,r),new u(i,o),new u(s,a)])},circle:function(t,e,n){return new c("Circle",[new u(t,e),n])},ellipse:function(t,e,n,r){return new c("Ellipse",[new u(t,e),n,r])},line:function(t,e,n,r){return new c("Line",[new u(t,e),new u(n,r)])},path:function(t){return new c("Path",t)},polygon:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new c("Polygon",[e])},polyline:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new c("Polyline",[e])},rectangle:function(t,e,n,r){return new c("Rectangle",[new u(t,e),new u(t+n,e+r)])}};t.exports=e}),e(function(t){var i=l,e={quadraticBezier:function(t,e,n){return new i("Bezier2",[t,e,n])},cubicBezier:function(t,e,n,r){return new i("Bezier3",[t,e,n,r])},circle:function(t,e){return new i("Circle",[t,e])},ellipse:function(t,e,n){return new i("Ellipse",[t,e,n])},line:function(t,e){return new i("Line",[t,e])},path:function(t){return new i("Path",[t])},polygon:function(t){return new i("Polygon",[t])},polyline:function(t){return new i("Polyline",[t])},rectangle:function(t,e){return new i("Rectangle",[t,t.add(e)])}};t.exports=e}),e(function(t){var r=n.Vector2D,e={pointInCircle:function(t,e,n){return r.fromPoints(e,t).length()<=n},pointInEllipse:function(t,e,n,r){var i=t.subtract(e);return i.x*i.x/(n*n)+i.y*i.y/(r*r)<=1},pointInPolyline:function(t,e){for(var n,r=e.length,i=0,o=e[0],s=1;s<=r;s++){var a=e[s%r],u=Math.min(o.y,a.y),c=Math.max(o.y,a.y),l=Math.max(o.x,a.x);o.y!=a.y&&u<t.y&&t.y<=c&&t.x<=l&&(n=(t.y-o.y)*(a.x-o.x)/(a.y-o.y)+o.x,(o.x==a.x||t.x<=n)&&i++),o=a}return i%2==1}};e.pointInPolygon=e.pointInPolyline,e.pointInRectangle=function(t,e,n){return e.x<=t.x&&t.x<n.x&&e.y<=t.y&&t.y<n.y},t.exports=e}),a),ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g=e(function(t,e){var r="__lodash_hash_undefined__",_=1,v=2,n=9007199254740991,g="[object Arguments]",m="[object Array]",i="[object AsyncFunction]",b="[object Boolean]",w="[object Date]",P="[object Error]",o="[object Function]",s="[object GeneratorFunction]",M="[object Map]",I="[object Number]",a="[object Null]",L="[object Object]",u="[object Promise]",c="[object Proxy]",S="[object RegExp]",j="[object Set]",E="[object String]",R="[object Symbol]",l="[object Undefined]",h="[object WeakMap]",T="[object ArrayBuffer]",C="[object DataView]",y=/^\[object .+?Constructor\]$/,p=/^(?:0|[1-9]\d*)$/,f={};f["[object Float32Array]"]=f["[object Float64Array]"]=f["[object Int8Array]"]=f["[object Int16Array]"]=f["[object Int32Array]"]=f["[object Uint8Array]"]=f["[object Uint8ClampedArray]"]=f["[object Uint16Array]"]=f["[object Uint32Array]"]=!0,f[g]=f[m]=f[T]=f[b]=f[C]=f[w]=f[P]=f[o]=f[M]=f[I]=f[L]=f[S]=f[j]=f[E]=f[h]=!1;var d="object"==ee(te)&&te&&te.Object===Object&&te,x="object"==("undefined"==typeof self?"undefined":ee(self))&&self&&self.Object===Object&&self,N=d||x||Function("return this")(),z=e&&!e.nodeType&&e,O=z&&t&&!t.nodeType&&t,A=O&&O.exports===z,k=A&&d.process,B=function(){try{return k&&k.binding&&k.binding("util")}catch(t){}}(),F=B&&B.isTypedArray;function D(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function X(t){var n=-1,r=Array(t.size);return t.forEach(function(t,e){r[++n]=[e,t]}),r}function G(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var q,W,U,$=Array.prototype,Y=Function.prototype,V=Object.prototype,H=N["__core-js_shared__"],Q=Y.toString,Z=V.hasOwnProperty,J=(q=/[^.]+$/.exec(H&&H.keys&&H.keys.IE_PROTO||""))?"Symbol(src)_1."+q:"",K=V.toString,tt=RegExp("^"+Q.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),et=A?N.Buffer:void 0,nt=N.Symbol,rt=N.Uint8Array,it=V.propertyIsEnumerable,ot=$.splice,st=nt?nt.toStringTag:void 0,at=Object.getOwnPropertySymbols,ut=et?et.isBuffer:void 0,ct=(W=Object.keys,U=Object,function(t){return W(U(t))}),lt=Bt(N,"DataView"),ht=Bt(N,"Map"),yt=Bt(N,"Promise"),pt=Bt(N,"Set"),ft=Bt(N,"WeakMap"),dt=Bt(Object,"create"),xt=Gt(lt),vt=Gt(ht),gt=Gt(yt),mt=Gt(pt),_t=Gt(ft),bt=nt?nt.prototype:void 0,wt=bt?bt.valueOf:void 0;function Pt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Mt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function It(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Lt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new It;++e<n;)this.add(t[e])}function St(t){var e=this.__data__=new Mt(t);this.size=e.size}function jt(t,e){var n=Ut(t),r=!n&&Wt(t),i=!n&&!r&&$t(t),o=!n&&!r&&!i&&Jt(t),s=n||r||i||o,a=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],u=a.length;for(var c in t)!e&&!Z.call(t,c)||s&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Xt(c,u))||a.push(c);return a}function Et(t,e){for(var n=t.length;n--;)if(qt(t[n][0],e))return n;return-1}function Rt(t){return null==t?void 0===t?l:a:st&&st in Object(t)?function(t){var e=Z.call(t,st),n=t[st];try{var r=!(t[st]=void 0)}catch(t){}var i=K.call(t);r&&(e?t[st]=n:delete t[st]);return i}(t):(e=t,K.call(e));var e}function Tt(t){return Qt(t)&&Rt(t)==g}function Ct(t,e,n,r,i){return t===e||(null==t||null==e||!Qt(t)&&!Qt(e)?t!=t&&e!=e:function(t,e,n,r,i,o){var s=Ut(t),a=Ut(e),u=s?m:Dt(t),c=a?m:Dt(e),l=(u=u==g?L:u)==L,h=(c=c==g?L:c)==L,y=u==c;if(y&&$t(t)){if(!$t(e))return!1;l=!(s=!0)}if(y&&!l)return o||(o=new St),s||Jt(t)?Ot(t,e,n,r,i,o):function(t,e,n,r,i,o,s){switch(n){case C:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case T:return!(t.byteLength!=e.byteLength||!o(new rt(t),new rt(e)));case b:case w:case I:return qt(+t,+e);case P:return t.name==e.name&&t.message==e.message;case S:case E:return t==e+"";case M:var a=X;case j:var u=r&_;if(a||(a=G),t.size!=e.size&&!u)return!1;var c=s.get(t);if(c)return c==e;r|=v,s.set(t,e);var l=Ot(a(t),a(e),r,i,o,s);return s.delete(t),l;case R:if(wt)return wt.call(t)==wt.call(e)}return!1}(t,e,u,n,r,i,o);if(!(n&_)){var p=l&&Z.call(t,"__wrapped__"),f=h&&Z.call(e,"__wrapped__");if(p||f){var d=p?t.value():t,x=f?e.value():e;return o||(o=new St),i(d,x,n,r,o)}}if(!y)return!1;return o||(o=new St),function(t,e,n,r,i,o){var s=n&_,a=At(t),u=a.length,c=At(e).length;if(u!=c&&!s)return!1;for(var l=u;l--;){var h=a[l];if(!(s?h in e:Z.call(e,h)))return!1}var y=o.get(t);if(y&&o.get(e))return y==e;var p=!0;o.set(t,e),o.set(e,t);for(var f=s;++l<u;){h=a[l];var d=t[h],x=e[h];if(r)var v=s?r(x,d,h,e,t,o):r(d,x,h,t,e,o);if(!(void 0===v?d===x||i(d,x,n,r,o):v)){p=!1;break}f||(f="constructor"==h)}if(p&&!f){var g=t.constructor,m=e.constructor;g!=m&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof m&&m instanceof m)&&(p=!1)}return o.delete(t),o.delete(e),p}(t,e,n,r,i,o)}(t,e,n,r,Ct,i))}function Nt(t){return!(!Ht(t)||(e=t,J&&J in e))&&(Yt(t)?tt:y).test(Gt(t));var e}function zt(t){if(n=(e=t)&&e.constructor,r="function"==typeof n&&n.prototype||V,e!==r)return ct(t);var e,n,r,i=[];for(var o in Object(t))Z.call(t,o)&&"constructor"!=o&&i.push(o);return i}function Ot(t,e,r,i,o,s){var n=r&_,a=t.length,u=e.length;if(a!=u&&!(n&&a<u))return!1;var c=s.get(t);if(c&&s.get(e))return c==e;var l=-1,h=!0,y=r&v?new Lt:void 0;for(s.set(t,e),s.set(e,t);++l<a;){var p=t[l],f=e[l];if(i)var d=n?i(f,p,l,e,t,s):i(p,f,l,t,e,s);if(void 0!==d){if(d)continue;h=!1;break}if(y){if(!D(e,function(t,e){if(n=e,!y.has(n)&&(p===t||o(p,t,r,i,s)))return y.push(e);var n})){h=!1;break}}else if(p!==f&&!o(p,f,r,i,s)){h=!1;break}}return s.delete(t),s.delete(e),h}function At(t){return n=Ft,r=Kt(e=t),Ut(e)?r:function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}(r,n(e));var e,n,r}function kt(t,e){var n,r,i=t.__data__;return("string"==(r=void 0===(n=e)?"undefined":ee(n))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function Bt(t,e){var n,r,i=(r=e,null==(n=t)?void 0:n[r]);return Nt(i)?i:void 0}Pt.prototype.clear=function(){this.__data__=dt?dt(null):{},this.size=0},Pt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Pt.prototype.get=function(t){var e=this.__data__;if(dt){var n=e[t];return n===r?void 0:n}return Z.call(e,t)?e[t]:void 0},Pt.prototype.has=function(t){var e=this.__data__;return dt?void 0!==e[t]:Z.call(e,t)},Pt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=dt&&void 0===e?r:e,this},Mt.prototype.clear=function(){this.__data__=[],this.size=0},Mt.prototype.delete=function(t){var e=this.__data__,n=Et(e,t);return!(n<0||(n==e.length-1?e.pop():ot.call(e,n,1),--this.size,0))},Mt.prototype.get=function(t){var e=this.__data__,n=Et(e,t);return n<0?void 0:e[n][1]},Mt.prototype.has=function(t){return-1<Et(this.__data__,t)},Mt.prototype.set=function(t,e){var n=this.__data__,r=Et(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},It.prototype.clear=function(){this.size=0,this.__data__={hash:new Pt,map:new(ht||Mt),string:new Pt}},It.prototype.delete=function(t){var e=kt(this,t).delete(t);return this.size-=e?1:0,e},It.prototype.get=function(t){return kt(this,t).get(t)},It.prototype.has=function(t){return kt(this,t).has(t)},It.prototype.set=function(t,e){var n=kt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Lt.prototype.add=Lt.prototype.push=function(t){return this.__data__.set(t,r),this},Lt.prototype.has=function(t){return this.__data__.has(t)},St.prototype.clear=function(){this.__data__=new Mt,this.size=0},St.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},St.prototype.get=function(t){return this.__data__.get(t)},St.prototype.has=function(t){return this.__data__.has(t)},St.prototype.set=function(t,e){var n=this.__data__;if(n instanceof Mt){var r=n.__data__;if(!ht||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new It(r)}return n.set(t,e),this.size=n.size,this};var Ft=at?function(e){return null==e?[]:(e=Object(e),function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var s=t[n];e(s,n,t)&&(o[i++]=s)}return o}(at(e),function(t){return it.call(e,t)}))}:function(){return[]},Dt=Rt;function Xt(t,e){return!!(e=null==e?n:e)&&("number"==typeof t||p.test(t))&&-1<t&&t%1==0&&t<e}function Gt(t){if(null!=t){try{return Q.call(t)}catch(t){}try{return t+""}catch(t){}}return""}function qt(t,e){return t===e||t!=t&&e!=e}(lt&&Dt(new lt(new ArrayBuffer(1)))!=C||ht&&Dt(new ht)!=M||yt&&Dt(yt.resolve())!=u||pt&&Dt(new pt)!=j||ft&&Dt(new ft)!=h)&&(Dt=function(t){var e=Rt(t),n=e==L?t.constructor:void 0,r=n?Gt(n):"";if(r)switch(r){case xt:return C;case vt:return M;case gt:return u;case mt:return j;case _t:return h}return e});var Wt=Tt(function(){return arguments}())?Tt:function(t){return Qt(t)&&Z.call(t,"callee")&&!it.call(t,"callee")},Ut=Array.isArray;var $t=ut||function(){return!1};function Yt(t){if(!Ht(t))return!1;var e=Rt(t);return e==o||e==s||e==i||e==c}function Vt(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=n}function Ht(t){var e=void 0===t?"undefined":ee(t);return null!=t&&("object"==e||"function"==e)}function Qt(t){return null!=t&&"object"==(void 0===t?"undefined":ee(t))}var Zt,Jt=F?(Zt=F,function(t){return Zt(t)}):function(t){return Qt(t)&&Vt(t.length)&&!!f[Rt(t)]};function Kt(t){return null!=(e=t)&&Vt(e.length)&&!Yt(e)?jt(t):zt(t);var e}t.exports=function(t,e){return Ct(t,e)}}),u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c="__lodash_hash_undefined__",h=9007199254740991,p="[object Arguments]",f="[object Function]",d="[object GeneratorFunction]",x=/^\[object .+?Constructor\]$/,m="object"==u(te)&&te&&te.Object===Object&&te,_="object"==("undefined"==typeof self?"undefined":u(self))&&self&&self.Object===Object&&self,b=m||_||Function("return this")();function w(t,e){return!!(t?t.length:0)&&-1<function(t,e,n){if(e!=e)return function(t,e,n,r){var i=t.length,o=n+(r?1:-1);for(;r?o--:++o<i;)if(e(t[o],o,t))return o;return-1}(t,I,n);var r=n-1,i=t.length;for(;++r<i;)if(t[r]===e)return r;return-1}(t,e,0)}function P(t,e,n){for(var r=-1,i=t?t.length:0;++r<i;)if(n(e,t[r]))return!0;return!1}function M(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function I(t){return t!=t}function L(t,e){return t.has(e)}function S(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n}var j,E=Array.prototype,R=Function.prototype,T=Object.prototype,C=b["__core-js_shared__"],N=(j=/[^.]+$/.exec(C&&C.keys&&C.keys.IE_PROTO||""))?"Symbol(src)_1."+j:"",z=R.toString,O=T.hasOwnProperty,A=T.toString,k=RegExp("^"+z.call(O).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),B=b.Symbol,F=T.propertyIsEnumerable,D=E.splice,X=B?B.isConcatSpreadable:void 0,G=Math.max,q=tt(b,"Map"),W=tt(b,"Set"),U=tt(Object,"create");function $(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Y(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function V(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function H(t){var e=-1,n=t?t.length:0;for(this.__data__=new V;++e<n;)this.add(t[e])}function Q(t,e){for(var n,r,i=t.length;i--;)if((n=t[i][0])===(r=e)||n!=n&&r!=r)return i;return-1}function Z(t){return!(!ct(t)||(e=t,N&&N in e))&&(ut(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(t){}return e}(t)?k:x).test(function(t){if(null!=t){try{return z.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}$.prototype.clear=function(){this.__data__=U?U(null):{}},$.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},$.prototype.get=function(t){var e=this.__data__;if(U){var n=e[t];return n===c?void 0:n}return O.call(e,t)?e[t]:void 0},$.prototype.has=function(t){var e=this.__data__;return U?void 0!==e[t]:O.call(e,t)},$.prototype.set=function(t,e){return this.__data__[t]=U&&void 0===e?c:e,this},Y.prototype.clear=function(){this.__data__=[]},Y.prototype.delete=function(t){var e=this.__data__,n=Q(e,t);return!(n<0||(n==e.length-1?e.pop():D.call(e,n,1),0))},Y.prototype.get=function(t){var e=this.__data__,n=Q(e,t);return n<0?void 0:e[n][1]},Y.prototype.has=function(t){return-1<Q(this.__data__,t)},Y.prototype.set=function(t,e){var n=this.__data__,r=Q(n,t);return r<0?n.push([t,e]):n[r][1]=e,this},V.prototype.clear=function(){this.__data__={hash:new $,map:new(q||Y),string:new $}},V.prototype.delete=function(t){return K(this,t).delete(t)},V.prototype.get=function(t){return K(this,t).get(t)},V.prototype.has=function(t){return K(this,t).has(t)},V.prototype.set=function(t,e){return K(this,t).set(t,e),this},H.prototype.add=H.prototype.push=function(t){return this.__data__.set(t,c),this},H.prototype.has=function(t){return this.__data__.has(t)};var J=W&&1/S(new W([,-0]))[1]==1/0?function(t){return new W(t)}:function(){};function K(t,e){var n,r,i=t.__data__;return("string"==(r=void 0===(n=e)?"undefined":u(n))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function tt(t,e){var n,r,i=(r=e,null==(n=t)?void 0:n[r]);return Z(i)?i:void 0}function et(t){return ot(t)||at(e=t)&&O.call(e,"callee")&&(!F.call(e,"callee")||A.call(e)==p)||!!(X&&t&&t[X]);var e}var nt,rt,it=(nt=function(t){var e,n,r=(n=(e=t)?e.length:0)?e[n-1]:void 0;return at(r)&&(r=void 0),function(t,e,n){var r=-1,i=w,o=t.length,s=!0,a=[],u=a;if(n)s=!1,i=P;else if(200<=o){var c=e?null:J(t);if(c)return S(c);s=!1,i=L,u=new H}else u=e?[]:a;t:for(;++r<o;){var l=t[r],h=e?e(l):l;if(l=n||0!==l?l:0,s&&h==h){for(var y=u.length;y--;)if(u[y]===h)continue t;e&&u.push(h),a.push(l)}else i(u,h,n)||(u!==a&&u.push(h),a.push(l))}return a}(function t(e,n,r,i,o){var s=-1,a=e.length;for(r||(r=et),o||(o=[]);++s<a;){var u=e[s];0<n&&r(u)?1<n?t(u,n-1,r,i,o):M(o,u):i||(o[o.length]=u)}return o}(t,1,at,!0),void 0,r)},rt=G(void 0===rt?nt.length-1:rt,0),function(){for(var t=arguments,e=-1,n=G(t.length-rt,0),r=Array(n);++e<n;)r[e]=t[rt+e];e=-1;for(var i=Array(rt+1);++e<rt;)i[e]=t[e];return i[rt]=r,function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(nt,this,i)});var ot=Array.isArray;function st(t){return null!=t&&("number"==typeof(e=t.length)&&-1<e&&e%1==0&&e<=h)&&!ut(t);var e}function at(t){return!!(e=t)&&"object"==(void 0===e?"undefined":u(e))&&st(t);var e}function ut(t){var e=ct(t)?A.call(t):"";return e==f||e==d}function ct(t){var e=void 0===t?"undefined":u(t);return!!t&&("object"==e||"function"==e)}var lt=it,ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt=9007199254740991,pt="[object Arguments]",ft="[object Function]",dt="[object GeneratorFunction]",xt="object"==ht(te)&&te&&te.Object===Object&&te,vt="object"==("undefined"==typeof self?"undefined":ht(self))&&self&&self.Object===Object&&self,gt=xt||vt||Function("return this")();function mt(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var _t=Object.prototype,bt=_t.hasOwnProperty,wt=_t.toString,Pt=gt.Symbol,Mt=_t.propertyIsEnumerable,It=Pt?Pt.isConcatSpreadable:void 0;function Lt(t){return St(t)||!!(c=n=e=t)&&"object"==(void 0===c?"undefined":ht(c))&&(null!=(r=n)&&("number"==typeof(u=r.length)&&-1<u&&u%1==0&&u<=yt)&&(a=void 0===(s=i=r)?"undefined":ht(s),!((o=!s||"object"!=a&&"function"!=a?"":wt.call(i))==ft||o==dt)))&&bt.call(e,"callee")&&(!Mt.call(e,"callee")||wt.call(e)==pt)||!!(It&&t&&t[It]);var e,n,r,i,o,s,a,u,c}var St=Array.isArray;var jt=function(t){return t&&t.length?function t(e,n,r,i,o){var s=-1,a=e.length;for(r||(r=Lt),o||(o=[]);++s<a;){var u=e[s];0<n&&r(u)?1<n?t(u,n-1,r,i,o):mt(o,u):i||(o[o.length]=u)}return o}(t,1/0):[]};function Et(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var i=n[r],o=Object.getOwnPropertyDescriptor(e,i);o&&o.configurable&&void 0===t[i]&&Object.defineProperty(t,i,o)}}(t,e))}var Rt=function(n){function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,n.call(this,t));return e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",e._layerTMP=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP_TMP",e._chooseGeos=[],e._colorHit="#ffa400",e._colorChoose="#00bcd4",e}return Et(r,n),r.prototype.split=function(t,e){if(t instanceof maptalks.Polygon||t instanceof maptalks.LineString){if(this._initialTaskWithGeo(t),e instanceof maptalks.LineString&&(e=[e]),e instanceof Array&&0<e.length){this._splitWithTargets(e);var n=this._result;return this.remove(),n}return this}},r.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};this._splitWithTargets(),t(this._result,this._deals),this.remove()},r.prototype.cancel=function(){this.remove()},r.prototype.remove=function(){this._map;this._tmpLayer&&this._tmpLayer.remove(),this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._tmpLayer,delete this._chooseLayer,delete this._mousemove,delete this._click,delete this._dblclick},r.prototype._initialTaskWithGeo=function(t){this._insureSafeTask(),this._savePrivateGeometry(t)},r.prototype._insureSafeTask=function(){this.geometry&&this.remove()},r.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t._layer,t.getType().startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(this.layer.map)},r.prototype._addTo=function(t){return this._chooseLayer&&this.remove(),t._map_tool&&t._map_tool instanceof maptalks.DrawTool&&t._map_tool.disable(),this._map=t,this._tmpLayer=new maptalks.VectorLayer(this._layerTMP).addTo(t).bringToFront(),this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents(),this},r.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},r.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},r.prototype._mousemoveEvents=function(t){var r=this,i=this._getSafeCoords(),e=this.layer.identify(t.coordinate).reduce(function(t,e){var n=r._getSafeCoords(e);return!g(n,i)&&e instanceof maptalks.LineString?[].concat(t,[e]):t},[]);this._updateHitGeo(e)},r.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates();if(t.options.numberOfShellPoints){var n=t.options,r=n.numberOfShellPoints;n.numberOfShellPoints=300,t.setOptions(n),e=[t.getShell()],n.numberOfShellPoints=r||60,t.setOptions(n)}return e},r.prototype._updateHitGeo=function(t){if(this._needRefreshSymbol){var e=this._chooseLayer.getGeometryById("_hit");e&&(e.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}if(t&&0<t.length){this._needRefreshSymbol=!0,this.hitGeo=t[0];var n=this._getSymbolOrDefault(this.hitGeo,"Hit");this._copyGeoUpdateSymbol(this.hitGeo,n).setId("_hit")}},r.prototype._getSymbolOrDefault=function(t,e){var n=t.getSymbol(),r=this["_color"+e];if(n){for(var i in n)(i.endsWith("Fill")||i.endsWith("Color"))&&(n[i]=r);n.lineWidth=4}else n={lineColor:r,lineWidth:4};return n},r.prototype._copyGeoUpdateSymbol=function(t,e){return t.copy().updateSymbol(e).addTo(this._chooseLayer)},r.prototype._clickEvents=function(t){if(this.hitGeo){var e=this._getSafeCoords(this.hitGeo);this._setChooseGeosExceptHit(e),this._updateChooseGeos()}},r.prototype._setChooseGeosExceptHit=function(r,t){var i=this,e=this._chooseGeos.reduce(function(t,e){var n=i._getSafeCoords(e);return g(r,n)?t:[].concat(t,[e])},[]);t||e.length!==this._chooseGeos.length?this._chooseGeos=e:this._chooseGeos.push(this.hitGeo)},r.prototype._updateChooseGeos=function(){var n=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=n._getSymbolOrDefault(t,"Choose");n._copyGeoUpdateSymbol(t,e)})},r.prototype._splitWithTargets=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos;this.geometry&&(this._deals=this.options.deleteTargets?t:[],this.geometry instanceof maptalks.Polygon&&this._splitPolygonWithTargets(t),this.geometry instanceof maptalks.LineString&&this._splitLineWithTargets(t))},r.prototype._splitPolygonWithTargets=function(t){var r=this,e=void 0;(t=this._getPolygonAvailTargets(t)).forEach(function(n){e=e?e.reduce(function(t,e){return r.geometry=e,[].concat(t,r._splitPolygonTargetBase(n))},[]):r._splitPolygonTargetBase(n),r.options.deleteTargets&&n.remove()}),this._result=e},r.prototype._getPolygonAvailTargets=function(t){var r=this;return t.reduce(function(t,e){var n=[].concat(t,r._getPolygonAvailTarget(e));return r.options.deleteTargets&&e.remove(),n},[])},r.prototype._getPolygonAvailTarget=function(t){for(var e=[],n=[],r=!1,i=this._getSafeCoords(t),o=0;o<i.length;o++)if(r){e=lt(e,[i[o]],g);var s=this.geometry.containsPoint(i[o-1]),a=!this.geometry.containsPoint(i[o]);s&&a&&(r=!1,e=lt(e,[i[o]],g),n.push(e),e=[],o--)}else if(i[o+1]){var u=new maptalks.LineString([i[o],i[o+1]]);if(0<this._getPolygonPolylineIntersectPoints(u).length){var c=!this.geometry.containsPoint(i[o]),l=this.geometry.containsPoint(i[o+1]);c&&l?(r=!0,e=lt(e,[i[o]],g)):n.push([i[o],i[o+1]])}}return n.map(function(t){return new maptalks.LineString(t)})},r.prototype._getPolygonPolylineIntersectPoints=function(t){var e=this._getPoint2dFromCoords(this.geometry),n=this._getPoint2dFromCoords(t);return v.intersectPolygonPolyline(e,n).points},r.prototype._splitPolygonTargetBase=function(t){var e=this._getPolygonPolylineIntersectPoints(t),n=void 0;if(2===e.length)n=this._splitWithTargetMoreTwo(t);else{if(!(2===this._getSafeCoords(t).length&&2<e.length))return[this.geometry];n=this._splitWithTargetCommon(t)}return this.geometry.remove(),n},r.prototype._splitWithTargetCommon=function(t){for(var e=this,n=this._getSafeCoords()[0],r=this._getPoint2dFromCoords(t),i=!0,o=[],s=[],a=[],u=0;u<n.length-1;u++){var c=new maptalks.LineString([n[u],n[u+1]]),l=this._getPoint2dFromCoords(c),h=v.intersectPolylinePolyline(r,l).points,y=this._getCoordsFromPoints(h)[0];g(n[u],y)||0<h.length?(i?(o.push(n[u],y),s.push(y)):(o.push(y),s.push(n[u],y),a.push(s),s=[]),i=!i):i?o.push(n[u]):s.push(n[u])}var p=[],f=this.geometry.getSymbol(),d=this.geometry.getProperties(),x=new maptalks.Polygon(o,{symbol:f,properties:d}).addTo(this.layer);return p.push(x),a.forEach(function(t){x=new maptalks.Polygon(t,{symbol:f,properties:d}).addTo(e.layer),p.push(x)}),p},r.prototype._getPoint2dFromCoords=function(t){var e=this._map,n=e.getZoom(),r=this._getSafeCoords(t);return jt(r).map(function(t){return e.coordinateToPoint(t,n)})},r.prototype._getCoordsFromPoints=function(t){t instanceof Array||(t=[t]);var e=this._map,n=e.getZoom();return t.map(function(t){return e.pointToCoordinate(t,n)})},r.prototype._splitWithTargetMoreTwo=function(t){for(var e=this._getSafeCoords()[0],n=this._getPoint2dFromCoords(t),r=!0,i=[],o=[],s=[],a=0;a<e.length-1;a++){var u=new maptalks.LineString([e[a],e[a+1]]),c=this._getPoint2dFromCoords(u),l=v.intersectPolylinePolyline(n,c).points,h=this._getCoordsFromPoints(l),y=h[0];g(e[a],y)||0<l.length?(r?i.push(e[a],y):i.push(y),0===s.length&&0<(s=this._getTargetGap(t,l[0])).length&&(i.push.apply(i,s),o.push.apply(o,s.reverse())),r?o.push(y):o.push(e[a],y),1<h.length?(i.push(h[1]),o.push(h[1])):r=!r):r?i.push(e[a]):o.push(e[a])}var p=[],f=this.geometry.getSymbol(),d=this.geometry.getProperties(),x=new maptalks.Polygon(i,{symbol:f,properties:d}).addTo(this.layer);return p.push(x),x=new maptalks.Polygon(o,{symbol:f,properties:d}).addTo(this.layer),p.push(x),p},r.prototype._getTargetGap=function(t,e){var n=this._getSafeCoords(t),r=(this._getPoint2dFromCoords(this.geometry),!1),i=[],o=void 0;this._tmpLayer.hide();for(var s=0;s<n.length-1;s++){r&&i.push(s);var a=new maptalks.LineString([n[s],n[s+1]]),u=this._getPolygonPolylineIntersectPoints(a);0<u.length&&(g(u[0],e)&&(o=s+1),r=!r)}return this._tmpLayer.clear().show(),i[0]!==o&&i.reverse(),i.map(function(t){return n[t]})},r.prototype._splitLineWithTargets=function(t){var r=this;t=this._getLineAvailTargets(t);var e=void 0;t.forEach(function(n){e=e?e.reduce(function(t,e){return r.geometry=e,[].concat(t,r._splitLineTargetBase(n))},[]):r._splitLineTargetBase(n),r.options.deleteTargets&&n.remove()}),this._result=e},r.prototype._splitLineTargetBase=function(t){for(var e=this,n=this._getPoint2dFromCoords(t),r=this._getSafeCoords(),i=[r[0]],o=[],s=0;s<r.length;s++)if(r[s+1]){var a=new maptalks.LineString([r[s],r[s+1]]),u=this._getPoint2dFromCoords(a),c=v.intersectPolylinePolyline(n,u).points;if(0<c.length){var l=this._getCoordsFromPoints(c)[0];i.push(l),o.push(i),i=[l,r[s+1]]}else i.push(r[s+1])}else 0<i.length&&(i.push(r[s]),o.push(i));var h=o.map(function(t){return new maptalks.LineString(t).addTo(e.layer)});return this.geometry.remove(),h},r.prototype._getLineAvailTargets=function(t){var r=this;return t.reduce(function(t,e){var n=[].concat(t,r._getLineAvailTarget(e));return r.options.deleteTargets&&e.remove(),n},[])},r.prototype._getLineAvailTarget=function(t){for(var e=[],n=this._getSafeCoords(t),r=0;r<n.length-1;r++){var i=new maptalks.LineString([n[r],n[r+1]]);0<this._getPolygonPolylineIntersectPoints(i).length&&e.push(i)}return e},r}(maptalks.Class);Rt.mergeOptions({deleteTargets:!0}),t.GeoSplit=Rt,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.geosplit v0.1.0")});